<!doctype html>
<html lang="ru">
 <head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>–õ–∞–≥–µ—Ä—å –í–æ–∂–∞—Ç—ã—Ö</title>
  <script src="/_sdk/element_sdk.js"></script>
  <script src="https://telegram.org/js/telegram-web-app.js"></script>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
        body {
            box-sizing: border-box;
            background: #F0FFF0;
            color: #2F4F4F;
        }
        
        .generation-badge {
            padding: 2px 6px;
            border-radius: 12px;
            font-size: 10px;
            font-weight: bold;
            color: white;
        }
        
        .gen-z { background: #4682B4; }
        .millennial { background: #2E8B57; }
        .gen-x { background: #FF6347; }
        .boomer { background: #9370DB; }
        
        .achievement-badge {
            display: inline-block;
            padding: 2px 6px;
            border-radius: 8px;
            font-size: 10px;
            margin: 1px;
            color: white;
            font-weight: bold;
        }
        
        .bronze { background: linear-gradient(135deg, #CD7F32, #8B4513); }
        .silver { background: linear-gradient(135deg, #C0C0C0, #808080); }
        .gold { background: linear-gradient(135deg, #FFD700, #FFA500); }
        
        .notification {
            position: fixed;
            top: 20px;
            right: 20px;
            padding: 12px 20px;
            border-radius: 8px;
            color: white;
            font-weight: bold;
            transform: translateX(400px);
            transition: transform 0.3s ease;
            z-index: 1000;
            max-width: 300px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.3);
        }
        
        .notification.show {
            transform: translateX(0);
        }
        
        .collect-income-btn {
            background: linear-gradient(135deg, #32CD32, #228B22);
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
            animation: pulse 2s infinite;
        }
        
        .collect-income-btn:hover {
            transform: scale(1.05);
            box-shadow: 0 4px 15px rgba(50, 205, 50, 0.4);
        }
        
        @keyframes pulse {
            0% { box-shadow: 0 0 0 0 rgba(50, 205, 50, 0.7); }
            70% { box-shadow: 0 0 0 10px rgba(50, 205, 50, 0); }
            100% { box-shadow: 0 0 0 0 rgba(50, 205, 50, 0); }
        }
        
        .building-slot {
            width: 80px;
            height: 80px;
            border: 2px dashed #ccc;
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.3s ease;
            background: #f9f9f9;
        }
        
        .building-slot:hover {
            border-color: #2E8B57;
            background: #F0FFF0;
        }
        
        .building-slot.occupied {
            border: 2px solid #228B22;
            background: linear-gradient(135deg, #F0FFF0, #E6FFE6);
            cursor: default;
        }
        
        .building-btn {
            transition: all 0.3s ease;
            background: linear-gradient(135deg, #F0FFF0, #E6FFE6);
            border: 1px solid #2E8B57;
        }
        
        .building-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(46, 139, 87, 0.15);
            background: linear-gradient(135deg, #E6FFE6, #CCFFCC);
        }
        
        .building-btn.selected {
            background: linear-gradient(135deg, #32CD32, #228B22);
            color: white;
        }
        
        .stat-card {
            background: linear-gradient(135deg, #2E8B57 0%, #228B22 100%);
            color: white;
            border-radius: 12px;
            padding: 16px;
            text-align: center;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
        }
        
        .activity-btn {
            background: linear-gradient(135deg, #2E8B57 0%, #32CD32 100%);
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 8px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
            width: 100%;
        }
        
        .activity-btn:hover:not(:disabled) {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(46, 139, 87, 0.4);
        }
        
        .activity-btn:disabled {
            background: #ccc;
            cursor: not-allowed;
            transform: none;
        }
        
        .panel {
            background: white;
            border-radius: 16px;
            padding: 24px;
            box-shadow: 0 8px 32px rgba(0,0,0,0.1);
            border: 1px solid #e5e7eb;
        }
        
        .tab-btn {
            padding: 12px 24px;
            border: none;
            background: #f3f4f6;
            color: #6b7280;
            border-radius: 8px 8px 0 0;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s ease;
        }
        
        .tab-btn.active {
            background: linear-gradient(135deg, #2E8B57 0%, #228B22 100%);
            color: white;
        }
        
        .progress-bar {
            width: 100%;
            height: 8px;
            background: #e5e7eb;
            border-radius: 4px;
            overflow: hidden;
        }
        
        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #2E8B57, #32CD32);
            transition: width 0.3s ease;
        }
        
        /* –ê–¥–∞–ø—Ç–∏–≤–Ω—ã–π –¥–∏–∑–∞–π–Ω */
        @media (max-width: 1024px) {
            .building-slots-grid {
                grid-template-columns: repeat(3, 1fr);
            }
        }
        
        @media (max-width: 768px) {
            .building-slots-grid {
                grid-template-columns: repeat(2, 1fr);
            }
            
            .building-slot {
                width: 60px;
                height: 60px;
            }
            
            .stat-card {
                padding: 12px;
            }
            
            .panel {
                padding: 16px;
            }
        }
    </style>
  <style>@view-transition { navigation: auto; }</style>
  <script src="/_sdk/data_sdk.js" type="text/javascript"></script>
 </head>
 <body class="min-h-full">
  <div class="container mx-auto px-4 py-6 max-w-6xl"><!-- –ó–∞–≥–æ–ª–æ–≤–æ–∫ -->
   <div class="text-center mb-8">
    <h1 id="game-title" class="text-4xl font-bold mb-2" style="color: #2F4F4F;">üèïÔ∏è –õ–∞–≥–µ—Ä—å –í–æ–∂–∞—Ç—ã—Ö</h1>
    <p id="game-subtitle" class="text-lg" style="color: #2F4F4F;">–°–æ–∑–¥–∞–π –ª—É—á—à–∏–π –¥–µ—Ç—Å–∫–∏–π –ª–∞–≥–µ—Ä—å!</p>
   </div><!-- –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è -->
   <div id="notification" class="notification"></div><!-- –ü–∞–Ω–µ–ª—å —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏ -->
   <div id="registration-panel" class="panel mb-6">
    <h2 class="text-2xl font-bold mb-4" style="color: #2F4F4F;">üëã –î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å –≤ Telegram!</h2>
    <div id="telegram-user-info" class="mb-6 p-4 bg-blue-50 rounded-lg border border-blue-200">
     <div class="flex items-center mb-3">
      <div class="text-2xl mr-3">
       üë§
      </div>
      <div>
       <div class="font-semibold" id="telegram-name">
        –ó–∞–≥—Ä—É–∑–∫–∞...
       </div>
       <div class="text-sm text-gray-600" id="telegram-id">
        ID: ...
       </div>
      </div>
     </div>
     <div class="text-sm text-blue-700">
      –í–∞—à –∞–∫–∫–∞—É–Ω—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø—Ä–∏–≤—è–∑–∞–Ω –∫ Telegram
     </div>
    </div>
    <div class="mb-4"><label for="generation" class="block text-sm font-medium mb-2" style="color: #2F4F4F;">–í—ã–±–µ—Ä–∏—Ç–µ –≤–∞—à–µ –ø–æ–∫–æ–ª–µ–Ω–∏–µ</label> <select id="generation" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-transparent"> <option value="">–í—ã–±–µ—Ä–∏—Ç–µ –ø–æ–∫–æ–ª–µ–Ω–∏–µ</option> <option value="Gen Z">Gen Z (1997-2012)</option> <option value="Millennial">Millennial (1981-1996)</option> <option value="Gen X">Gen X (1965-1980)</option> <option value="Boomer">Boomer (1946-1964)</option> </select>
    </div>
    <div class="flex gap-4"><button onclick="startGameWithTelegram()" id="start-game-btn" class="flex-1 text-white px-6 py-3 rounded-lg font-semibold transition-all duration-300" style="background: linear-gradient(135deg, #2E8B57, #228B22);" disabled> üöÄ –ù–∞—á–∞—Ç—å –∏–≥—Ä—É </button>
    </div>
    <div id="telegram-error" class="mt-4 p-3 bg-red-50 border border-red-200 rounded-lg text-red-700 text-sm hidden">
     ‚ö†Ô∏è –ò–≥—Ä–∞ –¥–æ–ª–∂–Ω–∞ –±—ã—Ç—å –∑–∞–ø—É—â–µ–Ω–∞ —á–µ—Ä–µ–∑ Telegram WebApp
    </div>
   </div><!-- –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –∏–≥—Ä–æ–∫–∞ -->
   <div id="player-stats" class="grid grid-cols-2 md:grid-cols-4 lg:grid-cols-6 gap-4 mb-6" style="display: none;">
    <div class="stat-card">
     <div class="text-2xl font-bold" id="camp-level">
      1
     </div>
     <div class="text-sm opacity-90">
      üèïÔ∏è –£—Ä–æ–≤–µ–Ω—å
     </div>
    </div>
    <div class="stat-card">
     <div class="text-2xl font-bold" id="budget">
      1000
     </div>
     <div class="text-sm opacity-90">
      üí∞ –ë—é–¥–∂–µ—Ç
     </div>
    </div>
    <div class="stat-card">
     <div class="text-2xl font-bold" id="energy">
      100/100
     </div>
     <div class="text-sm opacity-90">
      ‚ö° –≠–Ω–µ—Ä–≥–∏—è
     </div>
    </div>
    <div class="stat-card">
     <div class="text-2xl font-bold" id="creativity">
      0
     </div>
     <div class="text-sm opacity-90">
      üé® –¢–≤–æ—Ä—á–µ—Å—Ç–≤–æ
     </div>
    </div>
    <div class="stat-card">
     <div class="text-2xl font-bold" id="reputation">
      50
     </div>
     <div class="text-sm opacity-90">
      üéØ –†–µ–ø—É—Ç–∞—Ü–∏—è
     </div>
    </div>
    <div class="stat-card">
     <div class="text-2xl font-bold" id="squad-size">
      10
     </div>
     <div class="text-sm opacity-90">
      üë• –û—Ç—Ä—è–¥
     </div>
    </div>
   </div><!-- –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ -->
   <div id="additional-stats" class="grid grid-cols-2 md:grid-cols-4 gap-4 mb-6" style="display: none;">
    <div class="bg-white p-4 rounded-lg shadow-md">
     <div class="flex justify-between items-center mb-2"><span class="text-sm" style="color: #2F4F4F;">üòä –°—á–∞—Å—Ç—å–µ</span> <span id="happiness-value" class="font-bold">50</span>
     </div>
     <div class="progress-bar">
      <div id="happiness-bar" class="progress-fill" style="width: 50%"></div>
     </div>
    </div>
    <div class="bg-white p-4 rounded-lg shadow-md">
     <div class="flex justify-between items-center mb-2"><span class="text-sm" style="color: #2F4F4F;">üìà –ê–∫—Ç–∏–≤–Ω–æ—Å—Ç—å</span> <span id="activity-value" class="font-bold">30</span>
     </div>
     <div class="progress-bar">
      <div id="activity-bar" class="progress-fill" style="width: 30%"></div>
     </div>
    </div>
    <div class="bg-white p-4 rounded-lg shadow-md text-center">
     <div class="text-lg font-bold" style="color: #2E8B57;" id="accumulated-budget">
      0
     </div>
     <div class="text-xs" style="color: #2F4F4F;">
      üíé –ù–∞–∫–æ–ø–ª–µ–Ω–æ
     </div><button onclick="collectIncome()" class="collect-income-btn mt-1"> üí∞ –°–æ–±—Ä–∞—Ç—å –¥–æ—Ö–æ–¥ </button>
    </div>
    <div class="bg-white p-4 rounded-lg shadow-md text-center">
     <div class="text-lg font-bold" style="color: #9370DB;" id="accumulated-creativity">
      0
     </div>
     <div class="text-xs" style="color: #2F4F4F;">
      üé® –ù–∞–∫–æ–ø–ª–µ–Ω–æ
     </div>
    </div>
   </div><!-- –ù–∞–≤–∏–≥–∞—Ü–∏–æ–Ω–Ω—ã–µ –≤–∫–ª–∞–¥–∫–∏ -->
   <div id="game-tabs" class="flex flex-wrap gap-2 mb-6" style="display: none;"><button onclick="showPanel('building')" class="tab-btn active" id="building-tab">üèóÔ∏è –°—Ç—Ä–æ–∏—Ç–µ–ª—å—Å—Ç–≤–æ</button> <button onclick="showPanel('activities')" class="tab-btn" id="activities-tab">üéØ –ê–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏</button> <button onclick="showPanel('competitions')" class="tab-btn" id="competitions-tab">‚öîÔ∏è –°–æ—Ä–µ–≤–Ω–æ–≤–∞–Ω–∏—è</button> <button onclick="showPanel('leaderboard')" class="tab-btn" id="leaderboard-tab">üèÜ –†–µ–π—Ç–∏–Ω–≥</button> <button onclick="showPanel('account')" class="tab-btn" id="account-tab">üë§ –ê–∫–∫–∞—É–Ω—Ç</button>
   </div><!-- –ü–∞–Ω–µ–ª—å —Å—Ç—Ä–æ–∏—Ç–µ–ª—å—Å—Ç–≤–∞ -->
   <div id="building-panel" class="panel" style="display: none;">
    <h2 class="text-2xl font-bold mb-6" style="color: #2F4F4F;">üèóÔ∏è –°—Ç—Ä–æ–∏—Ç–µ–ª—å—Å—Ç–≤–æ –ª–∞–≥–µ—Ä—è</h2><!-- –¢–∏–ø—ã –∑–¥–∞–Ω–∏–π -->
    <div class="mb-6">
     <h3 class="text-lg font-semibold mb-4" style="color: #2F4F4F;">–í—ã–±–µ—Ä–∏—Ç–µ —Ç–∏–ø –∑–¥–∞–Ω–∏—è:</h3>
     <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4"><button onclick="selectBuildingType('house', 200)" class="building-btn p-4 rounded-lg text-left">
       <div class="text-2xl mb-2">
        üè†
       </div>
       <div class="font-semibold">
        –î–æ–º–∏–∫
       </div>
       <div class="text-sm" style="color: #2F4F4F;">
        üí∞ 200
       </div></button> <button onclick="selectBuildingType('dining', 300)" class="building-btn p-4 rounded-lg text-left">
       <div class="text-2xl mb-2">
        üçΩÔ∏è
       </div>
       <div class="font-semibold">
        –°—Ç–æ–ª–æ–≤–∞—è
       </div>
       <div class="text-sm" style="color: #2F4F4F;">
        üí∞ 300
       </div></button> <button onclick="selectBuildingType('sports', 400)" class="building-btn p-4 rounded-lg text-left">
       <div class="text-2xl mb-2">
        ‚öΩ
       </div>
       <div class="font-semibold">
        –°–ø–æ—Ä—Ç–ø–ª–æ—â–∞–¥–∫–∞
       </div>
       <div class="text-sm" style="color: #2F4F4F;">
        üí∞ 400
       </div></button> <button onclick="selectBuildingType('creative', 350)" class="building-btn p-4 rounded-lg text-left">
       <div class="text-2xl mb-2">
        üé®
       </div>
       <div class="font-semibold">
        –¢–≤–æ—Ä—á–µ—Å–∫–∞—è —Å—Ç—É–¥–∏—è
       </div>
       <div class="text-sm" style="color: #2F4F4F;">
        üí∞ 350
       </div></button> <button onclick="selectBuildingType('ecozone', 250)" class="building-btn p-4 rounded-lg text-left">
       <div class="text-2xl mb-2">
        üå≤
       </div>
       <div class="font-semibold">
        –≠–∫–æ-–∑–æ–Ω–∞
       </div>
       <div class="text-sm" style="color: #2F4F4F;">
        üí∞ 250 | +20üí∞/–º–∏–Ω | +8üòä | +15‚ö°–º–∞–∫—Å
       </div></button>
     </div>
    </div><!-- –°–ª–æ—Ç—ã –¥–ª—è —Å—Ç—Ä–æ–∏—Ç–µ–ª—å—Å—Ç–≤–∞ -->
    <div class="mb-6">
     <h3 class="text-lg font-semibold mb-4" style="color: #2F4F4F;">–í—ã–±–µ—Ä–∏—Ç–µ –º–µ—Å—Ç–æ –¥–ª—è —Å—Ç—Ä–æ–∏—Ç–µ–ª—å—Å—Ç–≤–∞:</h3>
     <div class="building-slots-grid grid grid-cols-4 gap-4" id="building-slots"><!-- –°–ª–æ—Ç—ã –≥–µ–Ω–µ—Ä–∏—Ä—É—é—Ç—Å—è JavaScript -->
     </div>
    </div><!-- –ü–æ—Å—Ç—Ä–æ–µ–Ω–Ω—ã–µ –∑–¥–∞–Ω–∏—è -->
    <div>
     <h3 class="text-lg font-semibold mb-4" style="color: #2F4F4F;">–ü–æ—Å—Ç—Ä–æ–µ–Ω–Ω—ã–µ –∑–¥–∞–Ω–∏—è:</h3>
     <div id="built-buildings" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4"><!-- –ó–¥–∞–Ω–∏—è –æ—Ç–æ–±—Ä–∞–∂–∞—é—Ç—Å—è –∑–¥–µ—Å—å -->
     </div>
    </div>
   </div><!-- –ü–∞–Ω–µ–ª—å –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–µ–π -->
   <div id="activities-panel" class="panel" style="display: none;">
    <h2 class="text-2xl font-bold mb-6" style="color: #2F4F4F;">üéØ –ê–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏ –ª–∞–≥–µ—Ä—è</h2>
    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
     <div class="p-6 rounded-lg" style="background: linear-gradient(135deg, #F0FFF0, #E6FFE6);">
      <h3 class="text-xl font-semibold mb-4" style="color: #2F4F4F;">üé™ –û—Ä–≥–∞–Ω–∏–∑–æ–≤–∞—Ç—å –º–µ—Ä–æ–ø—Ä–∏—è—Ç–∏–µ</h3>
      <p class="mb-4" style="color: #2F4F4F;">–ü—Ä–æ–≤–µ–¥–∏—Ç–µ –≤–µ—Å–µ–ª–æ–µ –º–µ—Ä–æ–ø—Ä–∏—è—Ç–∏–µ –¥–ª—è –¥–µ—Ç–µ–π</p>
      <div class="text-sm mb-4" style="color: #2F4F4F;">
       –°—Ç–æ–∏–º–æ—Å—Ç—å: üí∞ 75 | ‚ö° 25<br>
        –ù–∞–≥—Ä–∞–¥–∞: üòä +8-18, üéØ +4-10, 30% —à–∞–Ω—Å üé® +5-15<br>
        –ö—É–ª–¥–∞—É–Ω: 2 –º–∏–Ω
      </div><button onclick="organizeEvent()" id="event-btn" class="activity-btn"> üé™ –û—Ä–≥–∞–Ω–∏–∑–æ–≤–∞—Ç—å –º–µ—Ä–æ–ø—Ä–∏—è—Ç–∏–µ </button>
     </div>
     <div class="p-6 rounded-lg" style="background: linear-gradient(135deg, #F0FFF0, #E6FFE6);">
      <h3 class="text-xl font-semibold mb-4" style="color: #2F4F4F;">üìö –û–±—É—á–∏—Ç—å –æ—Ç—Ä—è–¥</h3>
      <p class="mb-4" style="color: #2F4F4F;">–ü–æ–≤—ã—Å—å—Ç–µ –Ω–∞–≤—ã–∫–∏ –∏ –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—å –æ—Ç—Ä—è–¥–∞</p>
      <div class="text-sm mb-4" style="color: #2F4F4F;">
       –°—Ç–æ–∏–º–æ—Å—Ç—å: üí∞ 150<br>
        –ù–∞–≥—Ä–∞–¥–∞: üìà +10-25, 40% —à–∞–Ω—Å üé® +3-12, 20% —à–∞–Ω—Å –ø–æ–≤—ã—Å–∏—Ç—å —É—Ä–æ–≤–µ–Ω—å<br>
        –ö—É–ª–¥–∞—É–Ω: 3 –º–∏–Ω
      </div><button onclick="trainSquad()" id="train-btn" class="activity-btn"> üìö –û–±—É—á–∏—Ç—å –æ—Ç—Ä—è–¥ </button>
     </div>
     <div class="p-6 rounded-lg" style="background: linear-gradient(135deg, #F0FFF0, #E6FFE6);">
      <h3 class="text-xl font-semibold mb-4" style="color: #2F4F4F;">üé≠ –ü—Ä–æ–≤–µ—Å—Ç–∏ –∫–æ–Ω—Ü–µ—Ä—Ç</h3>
      <p class="mb-4" style="color: #2F4F4F;">–û—Ä–≥–∞–Ω–∏–∑—É–π—Ç–µ –≥—Ä–∞–Ω–¥–∏–æ–∑–Ω–æ–µ —à–æ—É</p>
      <div class="text-sm mb-4" style="color: #2F4F4F;">
       –°—Ç–æ–∏–º–æ—Å—Ç—å: üé® 80 | üí∞ 300 | ‚ö° 50<br>
        –ù–∞–≥—Ä–∞–¥–∞: üòä +15-30, üéØ +20-40, +75 —Ä–µ–π—Ç–∏–Ω–≥<br>
        –ö—É–ª–¥–∞—É–Ω: 5 –º–∏–Ω
      </div><button onclick="holdConcert()" id="concert-btn" class="activity-btn"> üé≠ –ü—Ä–æ–≤–µ—Å—Ç–∏ –∫–æ–Ω—Ü–µ—Ä—Ç </button>
     </div>
     <div class="p-6 rounded-lg" style="background: linear-gradient(135deg, #F0FFF0, #E6FFE6);">
      <h3 class="text-xl font-semibold mb-4" style="color: #2F4F4F;">üîã –í–æ—Å—Å—Ç–∞–Ω–æ–≤–∏—Ç—å —ç–Ω–µ—Ä–≥–∏—é</h3>
      <p class="mb-4" style="color: #2F4F4F;">–û—Ç–¥–æ—Ö–Ω–∏—Ç–µ –∏ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ —Å–∏–ª—ã</p>
      <div class="text-sm mb-4" style="color: #2F4F4F;">
       –°—Ç–æ–∏–º–æ—Å—Ç—å: üí∞ 200<br>
        –ù–∞–≥—Ä–∞–¥–∞: ‚ö° +40 (–¥–æ –º–∞–∫—Å–∏–º—É–º–∞)<br>
        –ö—É–ª–¥–∞—É–Ω: 2 –º–∏–Ω
      </div><button onclick="restoreEnergy()" id="rest-btn" class="activity-btn"> üîã –í–æ—Å—Å—Ç–∞–Ω–æ–≤–∏—Ç—å —ç–Ω–µ—Ä–≥–∏—é </button>
     </div>
    </div>
   </div><!-- –ü–∞–Ω–µ–ª—å —Å–æ—Ä–µ–≤–Ω–æ–≤–∞–Ω–∏–π -->
   <div id="competitions-panel" class="panel" style="display: none;">
    <h2 class="text-2xl font-bold mb-6" style="color: #2F4F4F;">‚öîÔ∏è –ë–∏—Ç–≤–∞ –ª–∞–≥–µ—Ä–µ–π</h2>
    <div class="mb-6"><label for="opponent-select" class="block text-sm font-medium mb-2" style="color: #2F4F4F;">–í—ã–±–µ—Ä–∏—Ç–µ —Å–æ–ø–µ—Ä–Ω–∏–∫–∞:</label> <select id="opponent-select" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-transparent"> <option value="">–í—ã–±–µ—Ä–∏—Ç–µ —Å–æ–ø–µ—Ä–Ω–∏–∫–∞</option> </select>
    </div>
    <div class="mb-6"><button onclick="startBattle()" class="w-full text-white px-6 py-3 rounded-lg font-semibold transition-all duration-300" style="background: linear-gradient(135deg, #FF6347, #DC143C);"> ‚öîÔ∏è –ù–∞—á–∞—Ç—å –±–∏—Ç–≤—É </button>
    </div>
    <div id="battle-result" class="mb-4 p-3 rounded-lg hidden">
     <div id="battle-log"></div>
    </div>
    <div class="bg-gray-50 p-4 rounded-lg">
     <h3 class="font-semibold mb-2" style="color: #2F4F4F;">üí™ –í–∞—à–∞ —Å–∏–ª–∞ –ª–∞–≥–µ—Ä—è:</h3>
     <div class="text-sm" style="color: #2F4F4F;">
      <div>
       üèïÔ∏è –£—Ä–æ–≤–µ–Ω—å –ª–∞–≥–µ—Ä—è: <span id="battle-level">1</span> (+<span id="battle-level-bonus">10</span>)
      </div>
      <div>
       üéØ –†–µ–ø—É—Ç–∞—Ü–∏—è: <span id="battle-reputation">50</span>
      </div>
      <div>
       üòä –°—á–∞—Å—Ç—å–µ –æ—Ç—Ä—è–¥–∞: <span id="battle-happiness">50</span>
      </div>
      <div>
       üìà –ê–∫—Ç–∏–≤–Ω–æ—Å—Ç—å: <span id="battle-activity">30</span>
      </div>
      <div class="font-semibold mt-2">
       üí™ –û–±—â–∞—è —Å–∏–ª–∞: <span id="total-power">140</span>
      </div>
     </div>
    </div>
   </div><!-- –ü–∞–Ω–µ–ª—å —Ä–µ–π—Ç–∏–Ω–≥–∞ -->
   <div id="leaderboard-panel" class="panel" style="display: none;">
    <h2 class="text-2xl font-bold mb-6" style="color: #2F4F4F;">üèÜ –†–µ–π—Ç–∏–Ω–≥ –ª–∞–≥–µ—Ä–µ–π</h2>
    <div id="leaderboard-content"><!-- –†–µ–π—Ç–∏–Ω–≥ –∑–∞–≥—Ä—É–∂–∞–µ—Ç—Å—è –∑–¥–µ—Å—å -->
    </div>
   </div><!-- –ü–∞–Ω–µ–ª—å –∞–∫–∫–∞—É–Ω—Ç–∞ -->
   <div id="account-panel" class="panel" style="display: none;">
    <h2 class="text-2xl font-bold mb-6" style="color: #2F4F4F;">üë§ –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∞–∫–∫–∞—É–Ω—Ç–æ–º</h2>
    <div class="grid md:grid-cols-2 gap-6">
     <div class="bg-gray-50 p-4 rounded-lg">
      <h3 class="font-semibold mb-4" style="color: #2F4F4F;">üìä –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ–± –∞–∫–∫–∞—É–Ω—Ç–µ</h3>
      <div class="space-y-2 text-sm">
       <div>
        üë§ –í–æ–∂–∞—Ç—ã–π: <span id="account-name" class="font-semibold">-</span>
       </div>
       <div>
        üÜî Telegram ID: <span id="account-telegram-id" class="font-semibold">-</span>
       </div>
       <div>
        üéØ –ü–æ–∫–æ–ª–µ–Ω–∏–µ: <span id="account-generation" class="font-semibold">-</span>
       </div>
       <div>
        üèïÔ∏è –£—Ä–æ–≤–µ–Ω—å –ª–∞–≥–µ—Ä—è: <span id="account-level" class="font-semibold">-</span>
       </div>
       <div>
        üèÜ –ü–æ–±–µ–¥ –≤ –±–∏—Ç–≤–∞—Ö: <span id="account-battles" class="font-semibold">-</span>
       </div>
       <div>
        üé≠ –ö–æ–Ω—Ü–µ—Ä—Ç–æ–≤ –ø—Ä–æ–≤–µ–¥–µ–Ω–æ: <span id="account-concerts" class="font-semibold">-</span>
       </div>
       <div>
        üé® –¢–≤–æ—Ä—á–µ—Å–∫–∏–π —Ä–µ–π—Ç–∏–Ω–≥: <span id="account-creativity-rating" class="font-semibold">-</span>
       </div>
      </div>
     </div>
     <div class="bg-gray-50 p-4 rounded-lg">
      <h3 class="font-semibold mb-4" style="color: #2F4F4F;">üèÖ –î–æ—Å—Ç–∏–∂–µ–Ω–∏—è</h3>
      <div id="achievements-list" class="text-sm"><!-- –î–æ—Å—Ç–∏–∂–µ–Ω–∏—è –æ—Ç–æ–±—Ä–∞–∂–∞—é—Ç—Å—è –∑–¥–µ—Å—å -->
      </div>
     </div>
    </div>
    <div class="mt-6">
     <div class="mb-4"><button onclick="saveAccountComplete()" class="w-full text-white px-4 py-2 rounded-lg font-semibold transition-all duration-300" style="background: linear-gradient(135deg, #32CD32, #228B22);"> üíæ –°–æ—Ö—Ä–∞–Ω–∏—Ç—å –≤ –æ–±–ª–∞–∫–æ </button>
     </div><button onclick="logoutAccount()" class="w-full mt-4 text-white px-4 py-2 rounded-lg font-semibold transition-all duration-300" style="background: linear-gradient(135deg, #9370DB, #8B008B);"> üö™ –í—ã–π—Ç–∏ –∏–∑ –∞–∫–∫–∞—É–Ω—Ç–∞ </button>
    </div>
   </div>
  </div>
  <script>
        // Telegram WebApp –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è
        let telegramUser = null;
        let isTelegramWebApp = false;

        // –ü—Ä–æ–≤–µ—Ä–∫–∞ Telegram WebApp
        function initTelegramWebApp() {
            if (window.Telegram && window.Telegram.WebApp) {
                const tg = window.Telegram.WebApp;
                tg.ready();
                
                if (tg.initDataUnsafe && tg.initDataUnsafe.user) {
                    telegramUser = tg.initDataUnsafe.user;
                    isTelegramWebApp = true;
                    
                    // –û–±–Ω–æ–≤–ª—è–µ–º –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å —Å –¥–∞–Ω–Ω—ã–º–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
                    document.getElementById('telegram-name').textContent = 
                        telegramUser.first_name + (telegramUser.last_name ? ' ' + telegramUser.last_name : '');
                    document.getElementById('telegram-id').textContent = `ID: ${telegramUser.id}`;
                    
                    // –ê–∫—Ç–∏–≤–∏—Ä—É–µ–º –∫–Ω–æ–ø–∫—É
                    document.getElementById('start-game-btn').disabled = false;
                    
                    // –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∑–∞–≥—Ä—É–∂–∞–µ–º —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–π –∞–∫–∫–∞—É–Ω—Ç
                    loadExistingTelegramAccount();
                    
                    return true;
                } else {
                    showTelegramError();
                    return false;
                }
            } else {
                showTelegramError();
                return false;
            }
        }

        // –ü–æ–∫–∞–∑ –æ—à–∏–±–∫–∏ Telegram
        function showTelegramError() {
            document.getElementById('telegram-error').classList.remove('hidden');
            document.getElementById('telegram-name').textContent = '–ù–µ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–æ';
            document.getElementById('telegram-id').textContent = 'ID: –ù–µ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω';
            
            // –î–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è - —Å–æ–∑–¥–∞–µ–º —Ñ–µ–π–∫–æ–≤–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
            if (!window.Telegram || !window.Telegram.WebApp) {
                console.log('üß™ –†–µ–∂–∏–º —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è - —Å–æ–∑–¥–∞–µ–º —Ñ–µ–π–∫–æ–≤–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è');
                telegramUser = {
                    id: Math.floor(Math.random() * 1000000),
                    first_name: '–¢–µ—Å—Ç–æ–≤—ã–π',
                    last_name: '–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å'
                };
                isTelegramWebApp = true;
                
                document.getElementById('telegram-name').textContent = '–¢–µ—Å—Ç–æ–≤—ã–π –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å';
                document.getElementById('telegram-id').textContent = `ID: ${telegramUser.id}`;
                document.getElementById('start-game-btn').disabled = false;
                document.getElementById('telegram-error').classList.add('hidden');
                
                loadExistingTelegramAccount();
            }
        }

        // –ó–∞–≥—Ä—É–∑–∫–∞ —Å—É—â–µ—Å—Ç–≤—É—é—â–µ–≥–æ –∞–∫–∫–∞—É–Ω—Ç–∞ Telegram
        async function loadExistingTelegramAccount() {
            if (!telegramUser) return;
            
            const telegramId = telegramUser.id.toString();
            
            // –ü—Ä–æ–≤–µ—Ä—è–µ–º –æ–±–ª–∞—á–Ω–æ–µ —Ö—Ä–∞–Ω–∏–ª–∏—â–µ
            if (isCloudReady) {
                const existingPlayer = cloudPlayers.find(p => p.telegram_id === telegramId);
                if (existingPlayer) {
                    console.log('üîÑ –ù–∞–π–¥–µ–Ω —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–π –∞–∫–∫–∞—É–Ω—Ç –≤ –æ–±–ª–∞–∫–µ');
                    await loadPlayerFromTelegramData(existingPlayer);
                    showGamePanels();
                    showNotification(`–î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å –æ–±—Ä–∞—Ç–Ω–æ, ${gameState.counselorName}!`, 'success');
                    return;
                }
            }
            
            // –ü—Ä–æ–≤–µ—Ä—è–µ–º –ª–æ–∫–∞–ª—å–Ω–æ–µ —Ö—Ä–∞–Ω–∏–ª–∏—â–µ
            const localData = storage.loadLocal('telegram_' + telegramId);
            if (localData) {
                console.log('üîÑ –ù–∞–π–¥–µ–Ω —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–π –∞–∫–∫–∞—É–Ω—Ç –ª–æ–∫–∞–ª—å–Ω–æ');
                await loadPlayerData(localData);
                showGamePanels();
                showNotification(`–î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å –æ–±—Ä–∞—Ç–Ω–æ, ${gameState.counselorName}!`, 'success');
                return;
            }
            
            console.log('üëã –ù–æ–≤—ã–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å Telegram');
        }

        // –ù–∞—á–∞–ª–æ –∏–≥—Ä—ã —Å Telegram
        async function startGameWithTelegram() {
            if (!telegramUser) {
                showNotification('–û—à–∏–±–∫–∞ –ø–æ–ª—É—á–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö Telegram!', 'error');
                return;
            }
            
            const generation = document.getElementById('generation').value;
            if (!generation) {
                showNotification('–í—ã–±–µ—Ä–∏—Ç–µ –ø–æ–∫–æ–ª–µ–Ω–∏–µ!', 'error');
                return;
            }
            
            // –°–æ–∑–¥–∞–µ–º –Ω–æ–≤—ã–π –∞–∫–∫–∞—É–Ω—Ç
            const telegramName = telegramUser.first_name + (telegramUser.last_name ? ' ' + telegramUser.last_name : '');
            
            gameState.counselorName = telegramName;
            gameState.telegramId = telegramUser.id.toString();
            gameState.generation = generation;
            gameState.lastPlayed = Date.now();
            
            showGamePanels();
            updateUI();
            await saveGame();
            
            showNotification(`–î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å –≤ –ª–∞–≥–µ—Ä—å, ${telegramName}!`, 'success');
        }

        // –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é –¥–ª—è Elements SDK
        const defaultConfig = {
            camp_name: "–õ–∞–≥–µ—Ä—å –í–æ–∂–∞—Ç—ã—Ö",
            camp_motto: "–°–æ–∑–¥–∞–π –ª—É—á—à–∏–π –¥–µ—Ç—Å–∫–∏–π –ª–∞–≥–µ—Ä—å!"
        };

        // API –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è JSONBin
        const API_CONFIG = {
            API_KEY: "$2a$10$m9axI91k380kIRVCfXModexGqMS9WS07No.IKP/AY39BgkxocZnXO",
            BIN_ID: "6904eef0d0ea881f40c9ed5d"
        };

        // –°–æ—Å—Ç–æ—è–Ω–∏–µ –∏–≥—Ä—ã
        let gameState = {
            counselorName: '',
            telegramId: '',
            generation: '',
            campLevel: 1,
            budget: 1000,
            energy: 100,
            maxEnergy: 100,
            creativity: 0,
            reputation: 50,
            squadSize: 10,
            happiness: 50,
            activity: 30,
            buildings: [],
            achievements: [],
            concertsHeld: 0,
            creativityRating: 0,
            battleWins: 0,
            lastPlayed: Date.now(),
            accumulatedBudget: 0,
            accumulatedCreativity: 0,
            lastIncomeTime: Date.now(),
            lastBattleTime: 0,
            // –ù–æ–≤—ã–µ –ø–æ–ª—è –¥–ª—è –±–∞–ª–∞–Ω—Å–∏—Ä–æ–≤–∫–∏
            lastEventTime: 0,
            lastTrainingTime: 0,
            lastConcertTime: 0,
            lastRestTime: 0,
            dailyEvents: 0,
            dailyTrainings: 0,
            dailyConcerts: 0,
            dailyRests: 0,
            lastDailyReset: Date.now(),
            totalPlayTime: 0,
            sessionStartTime: Date.now()
        };

        // –¢–∏–ø—ã –∑–¥–∞–Ω–∏–π (–ø–µ—Ä–µ—Å–±–∞–ª–∞–Ω—Å–∏—Ä–æ–≤–∞–Ω—ã)
        const buildingTypes = {
            house: {
                name: '–î–æ–º–∏–∫',
                icon: 'üè†',
                cost: 300,
                income: 8,
                happiness: 8,
                squadBonus: 1,
                maxLevel: 5
            },
            dining: {
                name: '–°—Ç–æ–ª–æ–≤–∞—è',
                icon: 'üçΩÔ∏è',
                cost: 500,
                income: 12,
                happiness: 12,
                maxEnergyBonus: 15,
                maxLevel: 5
            },
            sports: {
                name: '–°–ø–æ—Ä—Ç–ø–ª–æ—â–∞–¥–∫–∞',
                icon: '‚öΩ',
                cost: 700,
                income: 15,
                activity: 15,
                reputation: 6,
                maxLevel: 5
            },
            creative: {
                name: '–¢–≤–æ—Ä—á–µ—Å–∫–∞—è —Å—Ç—É–¥–∏—è',
                icon: 'üé®',
                cost: 600,
                income: 10,
                creativityIncome: 20,
                happiness: 8,
                reputation: 5,
                maxLevel: 5
            },
            ecozone: {
                name: '–≠–∫–æ-–∑–æ–Ω–∞',
                icon: 'üå≤',
                cost: 400,
                income: 6,
                happiness: 6,
                maxEnergyBonus: 10,
                maxLevel: 5
            }
        };

        // –°–∏—Å—Ç–µ–º–∞ –∫—É–ª–¥–∞—É–Ω–æ–≤ (—É–º–µ–Ω—å—à–µ–Ω–Ω—ã–µ)
        const COOLDOWNS = {
            EVENT: 2 * 60 * 1000,      // 2 –º–∏–Ω—É—Ç—ã
            TRAINING: 3 * 60 * 1000,   // 3 –º–∏–Ω—É—Ç—ã
            CONCERT: 5 * 60 * 1000,    // 5 –º–∏–Ω—É—Ç
            REST: 2 * 60 * 1000,       // 2 –º–∏–Ω—É—Ç—ã
            BATTLE: 2 * 60 * 1000      // 2 –º–∏–Ω—É—Ç—ã
        };

        // –î–Ω–µ–≤–Ω—ã–µ –ª–∏–º–∏—Ç—ã —É–±—Ä–∞–Ω—ã - —Ç–µ–ø–µ—Ä—å –º–æ–∂–Ω–æ –∏–≥—Ä–∞—Ç—å –±–µ–∑ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–π!

        // –§—É–Ω–∫—Ü–∏—è —Ä–∞—Å—á–µ—Ç–∞ —Å—Ç–æ–∏–º–æ—Å—Ç–∏ —É–ª—É—á—à–µ–Ω–∏—è (–±–æ–ª–µ–µ –¥–æ—Ä–æ–≥–∞—è)
        function getUpgradeCost(buildingType, currentLevel) {
            const baseCost = buildingTypes[buildingType].cost;
            return Math.floor(baseCost * Math.pow(2, currentLevel)); // –£–≤–µ–ª–∏—á–µ–Ω–æ —Å 1.5 –¥–æ 2
        }

        // –ü—Ä–æ–≤–µ—Ä–∫–∞ –∏ —Å–±—Ä–æ—Å –¥–Ω–µ–≤–Ω—ã—Ö –ª–∏–º–∏—Ç–æ–≤
        function checkDailyReset() {
            const now = Date.now();
            const dayInMs = 24 * 60 * 60 * 1000;
            
            if (now - gameState.lastDailyReset > dayInMs) {
                gameState.dailyEvents = 0;
                gameState.dailyTrainings = 0;
                gameState.dailyConcerts = 0;
                gameState.dailyRests = 0;
                gameState.lastDailyReset = now;
                console.log('üîÑ –î–Ω–µ–≤–Ω—ã–µ –ª–∏–º–∏—Ç—ã —Å–±—Ä–æ—à–µ–Ω—ã');
            }
        }

        // –ü—Ä–æ–≤–µ—Ä–∫–∞ –∫—É–ª–¥–∞—É–Ω–∞
        function checkCooldown(lastActionTime, cooldownMs) {
            const now = Date.now();
            return now - lastActionTime >= cooldownMs;
        }

        // –ü–æ–ª—É—á–µ–Ω–∏–µ –≤—Ä–µ–º–µ–Ω–∏ –¥–æ –æ–∫–æ–Ω—á–∞–Ω–∏—è –∫—É–ª–¥–∞—É–Ω–∞
        function getCooldownRemaining(lastActionTime, cooldownMs) {
            const now = Date.now();
            const remaining = cooldownMs - (now - lastActionTime);
            return Math.max(0, remaining);
        }

        // –§–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –≤—Ä–µ–º–µ–Ω–∏ –∫—É–ª–¥–∞—É–Ω–∞
        function formatCooldownTime(ms) {
            const minutes = Math.ceil(ms / 60000);
            if (minutes < 60) {
                return `${minutes} –º–∏–Ω.`;
            } else {
                const hours = Math.floor(minutes / 60);
                const remainingMinutes = minutes % 60;
                return `${hours}—á ${remainingMinutes}–º`;
            }
        }

        // –†–∞—Å—á–µ—Ç —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏ –¥–µ–π—Å—Ç–≤–∏—è –Ω–∞ –æ—Å–Ω–æ–≤–µ –≤—Ä–µ–º–µ–Ω–∏ –∏–≥—Ä—ã
        function getActionEfficiency() {
            const playTimeHours = gameState.totalPlayTime / (1000 * 60 * 60);
            
            // –°–Ω–∏–∂–µ–Ω–∏–µ —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏ –ø—Ä–∏ –¥–ª–∏—Ç–µ–ª—å–Ω–æ–π –∏–≥—Ä–µ
            if (playTimeHours > 4) {
                return Math.max(0.3, 1 - (playTimeHours - 4) * 0.1);
            }
            return 1;
        }

        // –§—É–Ω–∫—Ü–∏—è —Ä–∞—Å—á–µ—Ç–∞ –±–æ–Ω—É—Å–æ–≤ –∑–¥–∞–Ω–∏—è —Å —É—á–µ—Ç–æ–º —É—Ä–æ–≤–Ω—è
        function getBuildingStats(buildingType, level) {
            const base = buildingTypes[buildingType];
            const multiplier = 1 + (level - 1) * 0.1; // +10% –∑–∞ –∫–∞–∂–¥—ã–π —É—Ä–æ–≤–µ–Ω—å
            
            return {
                income: base.income ? Math.floor(base.income * multiplier) : 0,
                creativityIncome: base.creativityIncome ? Math.floor(base.creativityIncome * multiplier) : 0,
                happiness: base.happiness ? Math.floor(base.happiness * multiplier) : 0,
                activity: base.activity ? Math.floor(base.activity * multiplier) : 0,
                reputation: base.reputation ? Math.floor(base.reputation * multiplier) : 0,
                squadBonus: base.squadBonus ? Math.floor(base.squadBonus * multiplier) : 0,
                maxEnergyBonus: base.maxEnergyBonus ? Math.floor(base.maxEnergyBonus * multiplier) : 0
            };
        }

        // –î–æ—Å—Ç–∏–∂–µ–Ω–∏—è
        const achievements = {
            experienced_counselor: {
                name: '–û–ø—ã—Ç–Ω—ã–π –≤–æ–∂–∞—Ç—ã–π',
                description: '–î–æ—Å—Ç–∏—á—å 3 —É—Ä–æ–≤–Ω—è –ª–∞–≥–µ—Ä—è',
                class: 'bronze',
                check: () => gameState.campLevel >= 3
            },
            camp_master: {
                name: '–ú–∞—Å—Ç–µ—Ä –ª–∞–≥–µ—Ä—è',
                description: '–î–æ—Å—Ç–∏—á—å 5 —É—Ä–æ–≤–Ω—è –ª–∞–≥–µ—Ä—è',
                class: 'silver',
                check: () => gameState.campLevel >= 5
            },
            builder: {
                name: '–°—Ç—Ä–æ–∏—Ç–µ–ª—å',
                description: '–ü–æ—Å—Ç—Ä–æ–∏—Ç—å 5 –∑–¥–∞–Ω–∏–π',
                class: 'bronze',
                check: () => gameState.buildings.length >= 5
            },
            respected_mentor: {
                name: '–£–≤–∞–∂–∞–µ–º—ã–π –Ω–∞—Å—Ç–∞–≤–Ω–∏–∫',
                description: '–ù–∞–±—Ä–∞—Ç—å 100+ —Ä–µ–ø—É—Ç–∞—Ü–∏–∏',
                class: 'silver',
                check: () => gameState.reputation >= 100
            },
            big_squad: {
                name: '–ë–æ–ª—å—à–æ–π –æ—Ç—Ä—è–¥',
                description: '–£–≤–µ–ª–∏—á–∏—Ç—å –æ—Ç—Ä—è–¥ –¥–æ 20+ –¥–µ—Ç–µ–π',
                class: 'gold',
                check: () => gameState.squadSize >= 20
            },
            children_joy: {
                name: '–†–∞–¥–æ—Å—Ç—å –¥–µ—Ç–µ–π',
                description: '–î–æ—Å—Ç–∏—á—å 90%+ —Å—á–∞—Å—Ç—å—è',
                class: 'gold',
                check: () => gameState.happiness >= 90
            },
            battle_winner: {
                name: '–ü–æ–±–µ–¥–∏—Ç–µ–ª—å –±–∏—Ç–≤',
                description: '–í—ã–∏–≥—Ä–∞—Ç—å 3+ –±–∏—Ç–≤—ã',
                class: 'silver',
                check: () => gameState.battleWins >= 3
            },
            creative_organizer: {
                name: '–¢–≤–æ—Ä—á–µ—Å–∫–∏–π –æ—Ä–≥–∞–Ω–∏–∑–∞—Ç–æ—Ä',
                description: '–ü—Ä–æ–≤–µ—Å—Ç–∏ –∫–æ–Ω—Ü–µ—Ä—Ç',
                class: 'bronze',
                check: () => gameState.concertsHeld >= 1
            }
        };

        // JSONBin –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è
        let cloudPlayers = [];
        let isCloudReady = false;

        // –°–∏—Å—Ç–µ–º–∞ —Ö—Ä–∞–Ω–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö
        const storage = {
            saveLocal: (key, data) => {
                try {
                    localStorage.setItem(key, JSON.stringify(data));
                } catch (e) {
                    console.error('–û—à–∏–±–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –≤ localStorage:', e);
                }
            },

            loadLocal: (key) => {
                try {
                    const data = localStorage.getItem(key);
                    return data ? JSON.parse(data) : null;
                } catch (e) {
                    console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –∏–∑ localStorage:', e);
                    return null;
                }
            },

            saveGameLocal: (gameData) => {
                if (gameData.telegramId) {
                    storage.saveLocal('telegram_' + gameData.telegramId, gameData);
                }
            },

            loadFromJsonBin: async () => {
                try {
                    console.log('üì• –ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö –∏–∑ JSONBin...');
                    const response = await fetch(`https://api.jsonbin.io/v3/b/${API_CONFIG.BIN_ID}/latest`, {
                        method: 'GET',
                        headers: {
                            'X-Master-Key': API_CONFIG.API_KEY,
                            'Content-Type': 'application/json'
                        }
                    });

                    if (!response.ok) {
                        throw new Error(`HTTP ${response.status}: ${response.statusText}`);
                    }

                    const data = await response.json();
                    cloudPlayers = data.record?.players || [];
                    isCloudReady = true;
                    
                    console.log('‚úÖ –î–∞–Ω–Ω—ã–µ –∑–∞–≥—Ä—É–∂–µ–Ω—ã –∏–∑ JSONBin:', cloudPlayers.length, '–∏–≥—Ä–æ–∫–æ–≤');
                    return true;
                } catch (error) {
                    console.error('‚ùå –û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –∏–∑ JSONBin:', error);
                    isCloudReady = false;
                    return false;
                }
            },

            saveToJsonBin: async (playersData) => {
                try {
                    console.log('üì§ –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö –≤ JSONBin...');
                    const response = await fetch(`https://api.jsonbin.io/v3/b/${API_CONFIG.BIN_ID}`, {
                        method: 'PUT',
                        headers: {
                            'X-Master-Key': API_CONFIG.API_KEY,
                            'Content-Type': 'application/json'
                        },
                        body: JSON.stringify({
                            players: playersData,
                            lastUpdated: new Date().toISOString()
                        })
                    });

                    if (!response.ok) {
                        throw new Error(`HTTP ${response.status}: ${response.statusText}`);
                    }

                    console.log('‚úÖ –î–∞–Ω–Ω—ã–µ —Å–æ—Ö—Ä–∞–Ω–µ–Ω—ã –≤ JSONBin');
                    return true;
                } catch (error) {
                    console.error('‚ùå –û—à–∏–±–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –≤ JSONBin:', error);
                    return false;
                }
            },

            savePlayerRating: async (playerData) => {
                if (!isCloudReady) {
                    console.log('‚ö†Ô∏è JSONBin –Ω–µ –≥–æ—Ç–æ–≤, –ø—ã—Ç–∞–µ–º—Å—è –ø–µ—Ä–µ–ø–æ–¥–∫–ª—é—á–∏—Ç—å—Å—è...');
                    const reconnected = await storage.loadFromJsonBin();
                    if (!reconnected) {
                        console.log('‚ùå –ù–µ —É–¥–∞–ª–æ—Å—å –ø–æ–¥–∫–ª—é—á–∏—Ç—å—Å—è –∫ JSONBin');
                        return false;
                    }
                }

                try {
                    // –í—Å–µ–≥–¥–∞ –∑–∞–≥—Ä—É–∂–∞–µ–º —Å–≤–µ–∂–∏–µ –¥–∞–Ω–Ω—ã–µ –ø–µ—Ä–µ–¥ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ–º
                    console.log('üîÑ –ó–∞–≥—Ä—É–∂–∞–µ–º –∞–∫—Ç—É–∞–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –ø–µ—Ä–µ–¥ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ–º...');
                    await storage.loadFromJsonBin();
                    
                    const existingPlayerIndex = cloudPlayers.findIndex(p => p.telegram_id === playerData.telegram_id);
                    
                    const playerRecord = {
                        counselor_name: playerData.counselor_name,
                        telegram_id: playerData.telegram_id,
                        generation: playerData.generation,
                        camp_level: playerData.camp_level,
                        budget: playerData.budget,
                        energy: playerData.energy,
                        max_energy: playerData.max_energy,
                        creativity: playerData.creativity,
                        reputation: playerData.reputation,
                        squad_size: playerData.squad_size,
                        happiness: playerData.happiness,
                        activity: playerData.activity,
                        buildings: JSON.stringify(playerData.buildings || []),
                        achievements: JSON.stringify(playerData.achievements || []),
                        concerts_held: playerData.concerts_held || 0,
                        creativity_rating: playerData.creativity_rating || 0,
                        battle_wins: playerData.battle_wins || 0,
                        last_played: new Date().toISOString(),
                        accumulated_budget: playerData.accumulated_budget || 0,
                        accumulated_creativity: playerData.accumulated_creativity || 0,
                        last_income_time: new Date().toISOString(),
                        // –î–æ–±–∞–≤–ª—è–µ–º –º–µ—Ç–∫—É –≤—Ä–µ–º–µ–Ω–∏ –¥–ª—è –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏—è
                        last_updated: new Date().toISOString(),
                        version: Date.now() // –í–µ—Ä—Å–∏—è –∑–∞–ø–∏—Å–∏ –¥–ª—è –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–µ–Ω–∏—è –∫–æ–Ω—Ñ–ª–∏–∫—Ç–æ–≤
                    };

                    if (existingPlayerIndex >= 0) {
                        console.log(`üîÑ –û–±–Ω–æ–≤–ª—è–µ–º —Å—É—â–µ—Å—Ç–≤—É—é—â–µ–≥–æ –∏–≥—Ä–æ–∫–∞: ${playerData.counselor_name}`);
                        cloudPlayers[existingPlayerIndex] = playerRecord;
                    } else {
                        console.log(`‚ûï –î–æ–±–∞–≤–ª—è–µ–º –Ω–æ–≤–æ–≥–æ –∏–≥—Ä–æ–∫–∞: ${playerData.counselor_name}`);
                        cloudPlayers.push(playerRecord);
                    }

                    console.log(`üíæ –°–æ—Ö—Ä–∞–Ω—è–µ–º ${cloudPlayers.length} –∏–≥—Ä–æ–∫–æ–≤ –≤ JSONBin...`);
                    const saved = await storage.saveToJsonBin([...cloudPlayers]); // –°–æ–∑–¥–∞–µ–º –∫–æ–ø–∏—é –º–∞—Å—Å–∏–≤–∞
                    
                    if (saved) {
                        console.log(`‚úÖ –ò–≥—Ä–æ–∫ ${playerData.counselor_name} —Å–æ—Ö—Ä–∞–Ω–µ–Ω –≤ JSONBin (–≤—Å–µ–≥–æ –∏–≥—Ä–æ–∫–æ–≤: ${cloudPlayers.length})`);
                        return true;
                    } else {
                        console.error('‚ùå –û—à–∏–±–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –∏–≥—Ä–æ–∫–∞ –≤ JSONBin');
                        return false;
                    }
                } catch (error) {
                    console.error('‚ùå –û—à–∏–±–∫–∞ –æ–±–ª–∞—á–Ω–æ–≥–æ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è:', error);
                    return false;
                }
            },

            getAllPlayers: async () => {
                if (isCloudReady && cloudPlayers.length > 0) {
                    return cloudPlayers.map(player => ({
                        counselor_name: player.counselor_name,
                        telegram_id: player.telegram_id,
                        generation: player.generation,
                        camp_level: player.camp_level,
                        reputation: player.reputation,
                        squad_size: player.squad_size,
                        battle_wins: player.battle_wins,
                        concerts_held: player.concerts_held,
                        creativity_rating: player.creativity_rating,
                        total_rating: (player.camp_level * 100) + player.reputation + (player.battle_wins * 20) + (player.concerts_held * 50),
                        last_updated: player.last_played,
                        buildings: player.buildings ? JSON.parse(player.buildings) : [],
                        achievements: player.achievements ? JSON.parse(player.achievements) : []
                    }));
                } else {
                    return [];
                }
            },

            getLeaderboard: async () => {
                const players = await storage.getAllPlayers();
                return players.sort((a, b) => {
                    const aRating = (a.total_rating || 0);
                    const bRating = (b.total_rating || 0);
                    return bRating - aRating;
                });
            }
        };

        // –ó–∞–≥—Ä—É–∑–∫–∞ –∏–≥—Ä–æ–∫–∞ –∏–∑ Telegram –¥–∞–Ω–Ω—ã—Ö
        async function loadPlayerFromTelegramData(cloudPlayer) {
            gameState.counselorName = cloudPlayer.counselor_name;
            gameState.telegramId = cloudPlayer.telegram_id;
            gameState.generation = cloudPlayer.generation;
            gameState.campLevel = cloudPlayer.camp_level;
            gameState.budget = cloudPlayer.budget;
            gameState.energy = cloudPlayer.energy;
            gameState.maxEnergy = cloudPlayer.max_energy;
            gameState.creativity = cloudPlayer.creativity;
            gameState.reputation = cloudPlayer.reputation;
            gameState.squadSize = cloudPlayer.squad_size;
            gameState.happiness = cloudPlayer.happiness;
            gameState.activity = cloudPlayer.activity;
            gameState.buildings = cloudPlayer.buildings ? JSON.parse(cloudPlayer.buildings) : [];
            gameState.achievements = cloudPlayer.achievements ? JSON.parse(cloudPlayer.achievements) : [];
            gameState.concertsHeld = cloudPlayer.concerts_held;
            gameState.creativityRating = cloudPlayer.creativity_rating;
            gameState.battleWins = cloudPlayer.battle_wins;
            gameState.lastPlayed = new Date(cloudPlayer.last_played).getTime();
            gameState.accumulatedBudget = cloudPlayer.accumulated_budget;
            gameState.accumulatedCreativity = cloudPlayer.accumulated_creativity;
            gameState.lastIncomeTime = new Date(cloudPlayer.last_income_time).getTime();
            
            updateUI();
        }

        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –∏–≥—Ä—ã
        async function initGame() {
            console.log('üöÄ –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –∏–≥—Ä—ã...');
            
            // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è Telegram WebApp
            initTelegramWebApp();
            
            // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è JSONBin
            console.log('üîÑ –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ JSONBin...');
            const cloudLoaded = await storage.loadFromJsonBin();
            
            if (cloudLoaded) {
                console.log('‚úÖ JSONBin —É—Å–ø–µ—à–Ω–æ –ø–æ–¥–∫–ª—é—á–µ–Ω');
            } else {
                console.log('‚ö†Ô∏è JSONBin –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω, –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –ª–æ–∫–∞–ª—å–Ω–æ–µ —Ö—Ä–∞–Ω–µ–Ω–∏–µ');
            }

            createBuildingSlots();
            updateUI();
            startIncomeGeneration();
            
            console.log('üéÆ –ò–≥—Ä–∞ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–∞');
        }

        // –°–æ–∑–¥–∞–Ω–∏–µ —Å–ª–æ—Ç–æ–≤ –¥–ª—è —Å—Ç—Ä–æ–∏—Ç–µ–ª—å—Å—Ç–≤–∞
        function createBuildingSlots() {
            const slotsContainer = document.getElementById('building-slots');
            slotsContainer.innerHTML = '';
            
            for (let i = 0; i < 12; i++) {
                const slot = document.createElement('div');
                slot.className = 'building-slot';
                slot.onclick = () => selectBuildingSlot(i);
                slot.innerHTML = `<span class="text-gray-400 text-2xl">+</span>`;
                slot.dataset.slot = i;
                slotsContainer.appendChild(slot);
            }
        }

        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞
        function updateUI() {
            document.getElementById('camp-level').textContent = gameState.campLevel;
            document.getElementById('budget').textContent = Math.floor(gameState.budget);
            document.getElementById('energy').textContent = `${Math.floor(gameState.energy)}/${gameState.maxEnergy}`;
            document.getElementById('creativity').textContent = Math.floor(gameState.creativity);
            document.getElementById('reputation').textContent = Math.floor(gameState.reputation);
            document.getElementById('squad-size').textContent = gameState.squadSize;
            
            document.getElementById('happiness-value').textContent = Math.floor(gameState.happiness);
            document.getElementById('happiness-bar').style.width = `${gameState.happiness}%`;
            document.getElementById('activity-value').textContent = Math.floor(gameState.activity);
            document.getElementById('activity-bar').style.width = `${gameState.activity}%`;
            document.getElementById('accumulated-budget').textContent = Math.floor(gameState.accumulatedBudget);
            document.getElementById('accumulated-creativity').textContent = Math.floor(gameState.accumulatedCreativity);
            
            document.getElementById('account-name').textContent = gameState.counselorName || '-';
            document.getElementById('account-telegram-id').textContent = gameState.telegramId || '-';
            document.getElementById('account-generation').textContent = gameState.generation || '-';
            document.getElementById('account-level').textContent = gameState.campLevel;
            document.getElementById('account-battles').textContent = gameState.battleWins;
            document.getElementById('account-concerts').textContent = gameState.concertsHeld;
            document.getElementById('account-creativity-rating').textContent = Math.floor(gameState.creativityRating);
            
            document.getElementById('battle-level').textContent = gameState.campLevel;
            document.getElementById('battle-level-bonus').textContent = gameState.campLevel * 10;
            document.getElementById('battle-reputation').textContent = Math.floor(gameState.reputation);
            document.getElementById('battle-happiness').textContent = Math.floor(gameState.happiness);
            document.getElementById('battle-activity').textContent = Math.floor(gameState.activity);
            
            const totalPower = (gameState.campLevel * 10) + gameState.reputation + gameState.happiness + gameState.activity;
            document.getElementById('total-power').textContent = Math.floor(totalPower);
            
            updateActivityButtons();
            updateBuildingSlots();
            updateBuiltBuildings();
            updateAchievements();
            checkAchievements();
        }

        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∫–Ω–æ–ø–æ–∫ –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–µ–π —Å —É—á–µ—Ç–æ–º –∫—É–ª–¥–∞—É–Ω–æ–≤ (–±–µ–∑ –¥–Ω–µ–≤–Ω—ã—Ö –ª–∏–º–∏—Ç–æ–≤)
        function updateActivityButtons() {
            const eventBtn = document.getElementById('event-btn');
            const trainBtn = document.getElementById('train-btn');
            const concertBtn = document.getElementById('concert-btn');
            const restBtn = document.getElementById('rest-btn');
            
            if (eventBtn) {
                const canAfford = gameState.budget >= 75 && gameState.energy >= 25;
                const cooldownOk = checkCooldown(gameState.lastEventTime, COOLDOWNS.EVENT);
                
                eventBtn.disabled = !canAfford || !cooldownOk;
                
                if (!cooldownOk) {
                    const remaining = getCooldownRemaining(gameState.lastEventTime, COOLDOWNS.EVENT);
                    eventBtn.textContent = `‚è∞ –ö—É–ª–¥–∞—É–Ω: ${formatCooldownTime(remaining)}`;
                } else {
                    eventBtn.textContent = `üé™ –û—Ä–≥–∞–Ω–∏–∑–æ–≤–∞—Ç—å –º–µ—Ä–æ–ø—Ä–∏—è—Ç–∏–µ`;
                }
            }
            
            if (trainBtn) {
                const canAfford = gameState.budget >= 150;
                const cooldownOk = checkCooldown(gameState.lastTrainingTime, COOLDOWNS.TRAINING);
                
                trainBtn.disabled = !canAfford || !cooldownOk;
                
                if (!cooldownOk) {
                    const remaining = getCooldownRemaining(gameState.lastTrainingTime, COOLDOWNS.TRAINING);
                    trainBtn.textContent = `‚è∞ –ö—É–ª–¥–∞—É–Ω: ${formatCooldownTime(remaining)}`;
                } else {
                    trainBtn.textContent = `üìö –û–±—É—á–∏—Ç—å –æ—Ç—Ä—è–¥`;
                }
            }
            
            if (concertBtn) {
                const canAfford = gameState.creativity >= 80 && gameState.budget >= 300 && gameState.energy >= 50;
                const cooldownOk = checkCooldown(gameState.lastConcertTime, COOLDOWNS.CONCERT);
                
                concertBtn.disabled = !canAfford || !cooldownOk;
                
                if (!cooldownOk) {
                    const remaining = getCooldownRemaining(gameState.lastConcertTime, COOLDOWNS.CONCERT);
                    concertBtn.textContent = `‚è∞ –ö—É–ª–¥–∞—É–Ω: ${formatCooldownTime(remaining)}`;
                } else {
                    concertBtn.textContent = `üé≠ –ü—Ä–æ–≤–µ—Å—Ç–∏ –∫–æ–Ω—Ü–µ—Ä—Ç`;
                }
            }
            
            if (restBtn) {
                const canAfford = gameState.budget >= 200;
                const needsRest = gameState.energy < gameState.maxEnergy;
                const cooldownOk = checkCooldown(gameState.lastRestTime, COOLDOWNS.REST);
                
                restBtn.disabled = !canAfford || !needsRest || !cooldownOk;
                
                if (!cooldownOk) {
                    const remaining = getCooldownRemaining(gameState.lastRestTime, COOLDOWNS.REST);
                    restBtn.textContent = `‚è∞ –ö—É–ª–¥–∞—É–Ω: ${formatCooldownTime(remaining)}`;
                } else {
                    restBtn.textContent = `üîã –í–æ—Å—Å—Ç–∞–Ω–æ–≤–∏—Ç—å —ç–Ω–µ—Ä–≥–∏—é`;
                }
            }
        }

        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å–ª–æ—Ç–æ–≤ –∑–¥–∞–Ω–∏–π
        function updateBuildingSlots() {
            const slots = document.querySelectorAll('.building-slot');
            
            slots.forEach((slot, index) => {
                const building = gameState.buildings.find(b => b.slot === index);
                
                if (building) {
                    const buildingType = buildingTypes[building.type];
                    const level = building.level || 1;
                    slot.className = 'building-slot occupied';
                    slot.innerHTML = `
                        <div class="text-center">
                            <div class="text-2xl">${buildingType.icon}</div>
                            <div class="text-xs font-bold text-green-600">–£—Ä.${level}</div>
                        </div>
                    `;
                    slot.onclick = null;
                } else {
                    slot.className = 'building-slot';
                    slot.innerHTML = `<span class="text-gray-400 text-2xl">+</span>`;
                    slot.onclick = () => selectBuildingSlot(index);
                }
            });
        }

        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å–ø–∏—Å–∫–∞ –ø–æ—Å—Ç—Ä–æ–µ–Ω–Ω—ã—Ö –∑–¥–∞–Ω–∏–π
        function updateBuiltBuildings() {
            const container = document.getElementById('built-buildings');
            container.innerHTML = '';
            
            if (gameState.buildings.length === 0) {
                container.innerHTML = '<div class="col-span-full text-center text-gray-500">–ó–¥–∞–Ω–∏–π –ø–æ–∫–∞ –Ω–µ—Ç</div>';
                return;
            }
            
            gameState.buildings.forEach((building, index) => {
                const buildingType = buildingTypes[building.type];
                const level = building.level || 1;
                const stats = getBuildingStats(building.type, level);
                const maxLevel = buildingType.maxLevel;
                
                const buildingElement = document.createElement('div');
                buildingElement.className = 'bg-white p-4 rounded-lg shadow-md border-l-4';
                buildingElement.style.borderColor = '#228B22';
                
                let bonuses = [];
                if (stats.happiness) bonuses.push(`üòä +${stats.happiness}`);
                if (stats.activity) bonuses.push(`üìà +${stats.activity}`);
                if (stats.reputation) bonuses.push(`üéØ +${stats.reputation}`);
                if (stats.squadBonus) bonuses.push(`üë• +${stats.squadBonus}`);
                if (stats.income) bonuses.push(`üí∞ +${stats.income}/–º–∏–Ω`);
                if (stats.creativityIncome) bonuses.push(`üé® +${stats.creativityIncome}/–º–∏–Ω`);
                if (stats.maxEnergyBonus) bonuses.push(`‚ö° +${stats.maxEnergyBonus}–º–∞–∫—Å`);
                
                let upgradeButton = '';
                if (level < maxLevel) {
                    const upgradeCost = getUpgradeCost(building.type, level);
                    const canUpgrade = gameState.budget >= upgradeCost;
                    const buttonClass = canUpgrade ? 
                        'bg-green-500 hover:bg-green-600 text-white' : 
                        'bg-gray-300 text-gray-500 cursor-not-allowed';
                    
                    upgradeButton = `
                        <button onclick="upgradeBuilding(${index})" 
                                class="mt-2 px-3 py-1 text-xs rounded-lg font-semibold transition-colors ${buttonClass}"
                                ${!canUpgrade ? 'disabled' : ''}>
                            ‚¨ÜÔ∏è –£–ª—É—á—à–∏—Ç—å (üí∞${upgradeCost})
                        </button>
                    `;
                } else {
                    upgradeButton = `
                        <div class="mt-2 px-3 py-1 text-xs rounded-lg font-semibold bg-yellow-100 text-yellow-800">
                            ‚≠ê –ú–∞–∫—Å–∏–º–∞–ª—å–Ω—ã–π —É—Ä–æ–≤–µ–Ω—å
                        </div>
                    `;
                }
                
                buildingElement.innerHTML = `
                    <div class="flex items-center justify-between mb-2">
                        <div class="flex items-center">
                            <span class="text-2xl mr-3">${buildingType.icon}</span>
                            <div>
                                <div class="font-semibold">${buildingType.name}</div>
                                <div class="text-sm text-gray-600">–°–ª–æ—Ç ${building.slot + 1} ‚Ä¢ –£—Ä–æ–≤–µ–Ω—å ${level}/${maxLevel}</div>
                            </div>
                        </div>
                        <div class="text-right">
                            <div class="text-sm font-bold text-green-600">–£—Ä.${level}</div>
                        </div>
                    </div>
                    <div class="text-xs mb-2" style="color: #2E8B57;">${bonuses.join(' | ')}</div>
                    ${upgradeButton}
                `;
                
                container.appendChild(buildingElement);
            });
        }

        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –¥–æ—Å—Ç–∏–∂–µ–Ω–∏–π
        function updateAchievements() {
            const container = document.getElementById('achievements-list');
            container.innerHTML = '';
            
            if (gameState.achievements.length === 0) {
                container.innerHTML = '<div class="text-gray-500">–î–æ—Å—Ç–∏–∂–µ–Ω–∏–π –ø–æ–∫–∞ –Ω–µ—Ç</div>';
                return;
            }
            
            gameState.achievements.forEach(achievementKey => {
                const achievement = achievements[achievementKey];
                if (achievement) {
                    const badge = document.createElement('span');
                    badge.className = `achievement-badge ${achievement.class} mr-1 mb-1`;
                    badge.textContent = achievement.name;
                    badge.title = achievement.description;
                    container.appendChild(badge);
                }
            });
        }

        // –ü–æ–∫–∞–∑ –ø–∞–Ω–µ–ª–∏
        function showPanel(panelName) {
            document.getElementById('building-panel').style.display = 'none';
            document.getElementById('activities-panel').style.display = 'none';
            document.getElementById('competitions-panel').style.display = 'none';
            document.getElementById('leaderboard-panel').style.display = 'none';
            document.getElementById('account-panel').style.display = 'none';
            
            document.querySelectorAll('.tab-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            
            document.getElementById(`${panelName}-panel`).style.display = 'block';
            document.getElementById(`${panelName}-tab`).classList.add('active');
            
            if (panelName === 'leaderboard') {
                loadLeaderboard();
            } else if (panelName === 'competitions') {
                loadOpponents();
            }
        }

        // –ü–æ–∫–∞–∑ –∏–≥—Ä–æ–≤—ã—Ö –ø–∞–Ω–µ–ª–µ–π
        function showGamePanels() {
            document.getElementById('registration-panel').style.display = 'none';
            document.getElementById('player-stats').style.display = 'grid';
            document.getElementById('additional-stats').style.display = 'grid';
            document.getElementById('game-tabs').style.display = 'flex';
            document.getElementById('building-panel').style.display = 'block';
        }

        // –í—ã–±–æ—Ä —Å–ª–æ—Ç–∞ –¥–ª—è —Å—Ç—Ä–æ–∏—Ç–µ–ª—å—Å—Ç–≤–∞
        let selectedBuildingType = null;
        let selectedBuildingCost = 0;

        function selectBuildingSlot(slotIndex) {
            if (!gameState.counselorName) {
                showNotification('–°–Ω–∞—á–∞–ª–∞ –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä—É–π—Ç–µ—Å—å!', 'error');
                return;
            }
            
            if (!selectedBuildingType) {
                showNotification('–°–Ω–∞—á–∞–ª–∞ –≤—ã–±–µ—Ä–∏—Ç–µ —Ç–∏–ø –∑–¥–∞–Ω–∏—è!', 'error');
                return;
            }
            
            const existingBuilding = gameState.buildings.find(b => b.slot === slotIndex);
            if (existingBuilding) {
                showNotification('–°–ª–æ—Ç —É–∂–µ –∑–∞–Ω—è—Ç!', 'error');
                return;
            }
            
            if (gameState.budget < selectedBuildingCost) {
                showNotification('–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –±—é–¥–∂–µ—Ç–∞!', 'error');
                return;
            }
            
            buildBuilding(selectedBuildingType, slotIndex, selectedBuildingCost);
        }

        function selectBuildingType(type, cost) {
            selectedBuildingType = type;
            selectedBuildingCost = cost;
            
            document.querySelectorAll('.building-btn').forEach(btn => {
                btn.classList.remove('selected');
            });
            
            event.target.classList.add('selected');
            
            showNotification(`–í—ã–±—Ä–∞–Ω–æ: ${buildingTypes[type].name}. –ö–ª–∏–∫–Ω–∏—Ç–µ –Ω–∞ —Å–≤–æ–±–æ–¥–Ω—ã–π —Å–ª–æ—Ç.`, 'info');
        }

        // –°—Ç—Ä–æ–∏—Ç–µ–ª—å—Å—Ç–≤–æ –∑–¥–∞–Ω–∏—è
        async function buildBuilding(type, slot, cost) {
            gameState.budget -= cost;
            
            const building = {
                type: type,
                slot: slot,
                level: 1,
                builtAt: Date.now()
            };
            
            gameState.buildings.push(building);
            
            const stats = getBuildingStats(type, 1);
            if (stats.happiness) gameState.happiness = Math.min(100, gameState.happiness + stats.happiness);
            if (stats.squadBonus) gameState.squadSize += stats.squadBonus;
            if (stats.activity) gameState.activity = Math.min(100, gameState.activity + stats.activity);
            if (stats.reputation) gameState.reputation += stats.reputation;
            if (stats.maxEnergyBonus) {
                gameState.maxEnergy += stats.maxEnergyBonus;
                gameState.energy = Math.min(gameState.energy, gameState.maxEnergy);
            }
            
            selectedBuildingType = null;
            selectedBuildingCost = 0;
            
            document.querySelectorAll('.building-btn').forEach(btn => {
                btn.classList.remove('selected');
            });
            
            updateUI();
            await saveGame();
            
            showNotification(`${buildingTypes[type].name} –ø–æ—Å—Ç—Ä–æ–µ–Ω–æ!`, 'success');
        }

        // –£–ª—É—á—à–µ–Ω–∏–µ –∑–¥–∞–Ω–∏—è
        async function upgradeBuilding(buildingIndex) {
            const building = gameState.buildings[buildingIndex];
            if (!building) return;
            
            const buildingType = buildingTypes[building.type];
            if (building.level >= buildingType.maxLevel) {
                showNotification('–ó–¥–∞–Ω–∏–µ —É–∂–µ –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–≥–æ —É—Ä–æ–≤–Ω—è!', 'error');
                return;
            }
            
            const upgradeCost = getUpgradeCost(building.type, building.level);
            if (gameState.budget < upgradeCost) {
                showNotification('–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –±—é–¥–∂–µ—Ç–∞ –¥–ª—è —É–ª—É—á—à–µ–Ω–∏—è!', 'error');
                return;
            }
            
            gameState.budget -= upgradeCost;
            
            const oldStats = getBuildingStats(building.type, building.level);
            const newStats = getBuildingStats(building.type, building.level + 1);
            
            const statsDiff = {
                happiness: newStats.happiness - oldStats.happiness,
                squadBonus: newStats.squadBonus - oldStats.squadBonus,
                activity: newStats.activity - oldStats.activity,
                reputation: newStats.reputation - oldStats.reputation,
                maxEnergyBonus: newStats.maxEnergyBonus - oldStats.maxEnergyBonus
            };
            
            if (statsDiff.happiness) gameState.happiness = Math.min(100, gameState.happiness + statsDiff.happiness);
            if (statsDiff.squadBonus) gameState.squadSize += statsDiff.squadBonus;
            if (statsDiff.activity) gameState.activity = Math.min(100, gameState.activity + statsDiff.activity);
            if (statsDiff.reputation) gameState.reputation += statsDiff.reputation;
            if (statsDiff.maxEnergyBonus) {
                gameState.maxEnergy += statsDiff.maxEnergyBonus;
                gameState.energy = Math.min(gameState.energy, gameState.maxEnergy);
            }
            
            building.level++;
            
            updateUI();
            await saveGame();
            
            showNotification(`${buildingType.name} —É–ª—É—á—à–µ–Ω–æ –¥–æ —É—Ä–æ–≤–Ω—è ${building.level}!`, 'success');
        }

        // –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –¥–æ—Ö–æ–¥–∞
        function startIncomeGeneration() {
            setInterval(() => {
                generateIncome();
            }, 60000);
        }

        function generateIncome() {
            if (!gameState.counselorName) return;
            
            let budgetIncome = 0;
            let creativityIncome = 0;
            
            gameState.buildings.forEach(building => {
                const level = building.level || 1;
                const stats = getBuildingStats(building.type, level);
                if (stats.income) budgetIncome += stats.income;
                if (stats.creativityIncome) creativityIncome += stats.creativityIncome;
            });
            
            if (budgetIncome > 0 || creativityIncome > 0) {
                gameState.accumulatedBudget += budgetIncome;
                gameState.accumulatedCreativity += creativityIncome;
                updateUI();
            }
        }

        // –°–±–æ—Ä –¥–æ—Ö–æ–¥–∞
        async function collectIncome() {
            if (gameState.accumulatedBudget > 0) {
                gameState.budget += gameState.accumulatedBudget;
                const collected = gameState.accumulatedBudget;
                gameState.accumulatedBudget = 0;
                showNotification(`–°–æ–±—Ä–∞–Ω–æ ${Math.floor(collected)} –±—é–¥–∂–µ—Ç–∞!`, 'success');
            }
            
            if (gameState.accumulatedCreativity > 0) {
                gameState.creativity += gameState.accumulatedCreativity;
                const collected = gameState.accumulatedCreativity;
                gameState.accumulatedCreativity = 0;
                showNotification(`–°–æ–±—Ä–∞–Ω–æ ${Math.floor(collected)} —Ç–≤–æ—Ä—á–µ—Å—Ç–≤–∞!`, 'success');
            }
            
            updateUI();
            await saveGame();
        }

        // –û—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏—è –º–µ—Ä–æ–ø—Ä–∏—è—Ç–∏—è (–±–µ–∑ –¥–Ω–µ–≤–Ω—ã—Ö –ª–∏–º–∏—Ç–æ–≤)
        async function organizeEvent() {
            // –ü—Ä–æ–≤–µ—Ä–∫–∏
            if (gameState.budget < 75 || gameState.energy < 25) return;
            if (!checkCooldown(gameState.lastEventTime, COOLDOWNS.EVENT)) return;
            
            gameState.budget -= 75;
            gameState.energy -= 25;
            gameState.lastEventTime = Date.now();
            
            const efficiency = getActionEfficiency();
            const happinessGain = (8 + Math.random() * 10) * efficiency;
            const reputationGain = (4 + Math.random() * 6) * efficiency;
            
            gameState.happiness = Math.min(100, gameState.happiness + happinessGain);
            gameState.reputation += reputationGain;
            
            let message = `–ú–µ—Ä–æ–ø—Ä–∏—è—Ç–∏–µ –ø—Ä–æ—à–ª–æ –æ—Ç–ª–∏—á–Ω–æ! +${Math.floor(happinessGain)} —Å—á–∞—Å—Ç—å—è, +${Math.floor(reputationGain)} —Ä–µ–ø—É—Ç–∞—Ü–∏–∏`;
            
            if (Math.random() < 0.3) {
                const creativityGain = (5 + Math.random() * 10) * efficiency;
                gameState.creativity += creativityGain;
                message += `, +${Math.floor(creativityGain)} —Ç–≤–æ—Ä—á–µ—Å—Ç–≤–∞`;
            }
            
            updateUI();
            await saveGame();
            
            showNotification(message, 'success');
        }

        // –û–±—É—á–µ–Ω–∏–µ –æ—Ç—Ä—è–¥–∞ (–±–µ–∑ –¥–Ω–µ–≤–Ω—ã—Ö –ª–∏–º–∏—Ç–æ–≤)
        async function trainSquad() {
            // –ü—Ä–æ–≤–µ—Ä–∫–∏
            if (gameState.budget < 150) return;
            if (!checkCooldown(gameState.lastTrainingTime, COOLDOWNS.TRAINING)) return;
            
            gameState.budget -= 150;
            gameState.lastTrainingTime = Date.now();
            
            const efficiency = getActionEfficiency();
            const activityGain = (10 + Math.random() * 15) * efficiency;
            gameState.activity = Math.min(100, gameState.activity + activityGain);
            
            let message = `–û—Ç—Ä—è–¥ –æ–±—É—á–µ–Ω! +${Math.floor(activityGain)} –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏`;
            
            if (Math.random() < 0.4) {
                const creativityGain = (3 + Math.random() * 9) * efficiency;
                gameState.creativity += creativityGain;
                message += `, +${Math.floor(creativityGain)} —Ç–≤–æ—Ä—á–µ—Å—Ç–≤–∞`;
            }
            
            // –°–Ω–∏–∂–µ–Ω —à–∞–Ω—Å –ø–æ–≤—ã—à–µ–Ω–∏—è —É—Ä–æ–≤–Ω—è
            if (Math.random() < 0.2 && gameState.campLevel < 10) {
                gameState.campLevel++;
                message += `, —É—Ä–æ–≤–µ–Ω—å –ª–∞–≥–µ—Ä—è –ø–æ–≤—ã—à–µ–Ω –¥–æ ${gameState.campLevel}!`;
            }
            
            updateUI();
            await saveGame();
            
            showNotification(message, 'success');
        }

        // –í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ —ç–Ω–µ—Ä–≥–∏–∏ (–±–µ–∑ –¥–Ω–µ–≤–Ω—ã—Ö –ª–∏–º–∏—Ç–æ–≤)
        async function restoreEnergy() {
            // –ü—Ä–æ–≤–µ—Ä–∫–∏
            if (gameState.budget < 200 || gameState.energy >= gameState.maxEnergy) return;
            if (!checkCooldown(gameState.lastRestTime, COOLDOWNS.REST)) return;
            
            gameState.budget -= 200;
            gameState.lastRestTime = Date.now();
            
            gameState.energy = Math.min(gameState.maxEnergy, gameState.energy + 40);
            
            updateUI();
            await saveGame();
            
            showNotification('–≠–Ω–µ—Ä–≥–∏—è –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∞!', 'success');
        }

        // –ü—Ä–æ–≤–µ–¥–µ–Ω–∏–µ –∫–æ–Ω—Ü–µ—Ä—Ç–∞ (–±–µ–∑ –¥–Ω–µ–≤–Ω—ã—Ö –ª–∏–º–∏—Ç–æ–≤)
        async function holdConcert() {
            // –ü—Ä–æ–≤–µ—Ä–∫–∏
            if (gameState.creativity < 80 || gameState.budget < 300 || gameState.energy < 50) return;
            if (!checkCooldown(gameState.lastConcertTime, COOLDOWNS.CONCERT)) return;
            
            gameState.creativity -= 80;
            gameState.budget -= 300;
            gameState.energy -= 50;
            gameState.lastConcertTime = Date.now();
            
            const efficiency = getActionEfficiency();
            const happinessGain = (15 + Math.random() * 15) * efficiency;
            const reputationGain = (20 + Math.random() * 20) * efficiency;
            const creativityRatingGain = 75 * efficiency;
            
            gameState.happiness = Math.min(100, gameState.happiness + happinessGain);
            gameState.reputation += reputationGain;
            gameState.creativityRating += creativityRatingGain;
            gameState.concertsHeld++;
            
            updateUI();
            await saveGame();
            
            showNotification(`–ö–æ–Ω—Ü–µ—Ä—Ç –ø—Ä–æ—à–µ–ª —Å –æ–≥—Ä–æ–º–Ω—ã–º —É—Å–ø–µ—Ö–æ–º! +${Math.floor(happinessGain)} —Å—á–∞—Å—Ç—å—è, +${Math.floor(reputationGain)} —Ä–µ–ø—É—Ç–∞—Ü–∏–∏, +${Math.floor(creativityRatingGain)} —Ä–µ–π—Ç–∏–Ω–≥`, 'success');
        }

        // –ë–∏—Ç–≤–∞ –ª–∞–≥–µ—Ä–µ–π
        async function startBattle() {
            const opponentSelect = document.getElementById('opponent-select');
            const selectedOption = opponentSelect.options[opponentSelect.selectedIndex];
            const opponentName = opponentSelect.value;
            
            if (!opponentName) {
                showNotification('–í—ã–±–µ—Ä–∏—Ç–µ —Å–æ–ø–µ—Ä–Ω–∏–∫–∞!', 'error');
                return;
            }
            
            const now = Date.now();
            const lastBattle = gameState.lastBattleTime || 0;
            const cooldownTime = 5 * 60 * 1000;
            
            if (now - lastBattle < cooldownTime) {
                const remainingTime = Math.ceil((cooldownTime - (now - lastBattle)) / 1000 / 60);
                showNotification(`–ü–æ–¥–æ–∂–¥–∏—Ç–µ ${remainingTime} –º–∏–Ω. –¥–æ —Å–ª–µ–¥—É—é—â–µ–π –±–∏—Ç–≤—ã!`, 'error');
                return;
            }
            
            const battleResult = document.getElementById('battle-result');
            const battleLog = document.getElementById('battle-log');
            
            battleResult.classList.remove('hidden');
            battleLog.innerHTML = '';
            
            const playerPower = (gameState.campLevel * 10) + gameState.reputation + gameState.happiness + gameState.activity;
            
            // –ü–æ–ª—É—á–∞–µ–º —Å–∏–ª—É —Å–æ–ø–µ—Ä–Ω–∏–∫–∞ –∏–∑ –¥–∞–Ω–Ω—ã—Ö
            let opponentPower;
            const opponentSource = selectedOption.dataset.source;
            
            if (selectedOption.dataset.power) {
                opponentPower = parseInt(selectedOption.dataset.power);
            } else {
                opponentPower = Math.random() * 200 + 100; // Fallback
            }
            
            const opponentIcon = 'üë§';
            const opponentType = '–∏–≥—Ä–æ–∫';
            
            battleLog.innerHTML += `<div class="mb-2 p-2 bg-blue-50 rounded text-sm">
                ‚öîÔ∏è <strong>–ë–∏—Ç–≤–∞ –Ω–∞—á–∏–Ω–∞–µ—Ç—Å—è!</strong><br>
                üë§ –í–∞—à –ª–∞–≥–µ—Ä—å: ${Math.floor(playerPower)} —Å–∏–ª—ã<br>
                ${opponentIcon} ${opponentName}: ${Math.floor(opponentPower)} —Å–∏–ª—ã
            </div>`;
            
            let playerWins = 0;
            let opponentWins = 0;
            
            for (let round = 1; round <= 3; round++) {
                await new Promise(resolve => setTimeout(resolve, 1500));
                
                const roundPlayerPower = playerPower * (0.8 + Math.random() * 0.4);
                const roundOpponentPower = opponentPower * (0.8 + Math.random() * 0.4);
                
                const roundWinner = roundPlayerPower > roundOpponentPower ? 'player' : 'opponent';
                
                if (roundWinner === 'player') {
                    playerWins++;
                    battleLog.innerHTML += `<div style="color: #2E8B57;">üèÜ –†–∞—É–Ω–¥ ${round}: –ü–æ–±–µ–¥–∞! (${Math.floor(roundPlayerPower)} vs ${Math.floor(roundOpponentPower)})</div>`;
                } else {
                    opponentWins++;
                    battleLog.innerHTML += `<div style="color: #FF6347;">üíî –†–∞—É–Ω–¥ ${round}: –ü–æ—Ä–∞–∂–µ–Ω–∏–µ (${Math.floor(roundPlayerPower)} vs ${Math.floor(roundOpponentPower)})</div>`;
                }
            }
            
            gameState.lastBattleTime = Date.now();
            
            if (playerWins > opponentWins) {
                const reputationGain = 25; // –ù–∞–≥—Ä–∞–¥–∞ –∑–∞ –ø–æ–±–µ–¥—É –Ω–∞–¥ –∏–≥—Ä–æ–∫–æ–º
                const budgetGain = Math.floor(opponentPower * 0.1); // –ë–æ–Ω—É—Å –±—é–¥–∂–µ—Ç–∞
                
                gameState.reputation += reputationGain;
                gameState.budget += budgetGain;
                gameState.battleWins++;
                
                battleLog.innerHTML += `<div style="color: #2E8B57;" class="font-bold mt-3 p-2 bg-green-50 rounded">
                    üèÜ <strong>–ü–û–ë–ï–î–ê!</strong><br>
                    +${reputationGain} —Ä–µ–ø—É—Ç–∞—Ü–∏–∏<br>
                    +${budgetGain} –±—é–¥–∂–µ—Ç–∞<br>
                    üéâ –ü–æ–±–µ–¥–∞ –Ω–∞–¥ –∏–≥—Ä–æ–∫–æ–º!
                </div>`;
                battleResult.style.background = 'linear-gradient(135deg, #F0FFF0, #E6FFE6)';
                battleResult.style.border = '1px solid #228B22';
            } else {
                const energyLoss = Math.min(20, gameState.energy);
                gameState.energy = Math.max(0, gameState.energy - energyLoss);
                
                battleLog.innerHTML += `<div style="color: #FF6347;" class="font-bold mt-3 p-2 bg-red-50 rounded">
                    üíî <strong>–ü–æ—Ä–∞–∂–µ–Ω–∏–µ...</strong><br>
                    -${energyLoss} —ç–Ω–µ—Ä–≥–∏–∏<br>
                    –¢—Ä–µ–Ω–∏—Ä—É–π—Ç–µ—Å—å –±–æ–ª—å—à–µ –∏ –≤–æ–∑–≤—Ä–∞—â–∞–π—Ç–µ—Å—å!
                </div>`;
                battleResult.style.background = 'linear-gradient(135deg, #FFE4E1, #FFCCCB)';
                battleResult.style.border = '1px solid #FF6347';
            }
            
            updateUI();
            await saveGame();
        }

        // –ó–∞–≥—Ä—É–∑–∫–∞ —Å–æ–ø–µ—Ä–Ω–∏–∫–æ–≤
        async function loadOpponents() {
            const opponentSelect = document.getElementById('opponent-select');
            opponentSelect.innerHTML = '<option value="">–í—ã–±–µ—Ä–∏—Ç–µ —Å–æ–ø–µ—Ä–Ω–∏–∫–∞</option>';
            
            // –°–æ–±–∏—Ä–∞–µ–º —Ç–æ–ª—å–∫–æ —Ä–µ–∞–ª—å–Ω—ã—Ö –∏–≥—Ä–æ–∫–æ–≤ –∏–∑ –æ–±–ª–∞—á–Ω–æ–≥–æ —Ä–µ–π—Ç–∏–Ω–≥–∞
            const allOpponents = new Map();
            
            if (isCloudReady && cloudPlayers.length > 0) {
                cloudPlayers.forEach(player => {
                    const playerName = player.counselor_name || '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω—ã–π';
                    const playerGeneration = player.generation || 'Gen Z';
                    const campLevel = player.camp_level || 1;
                    const reputation = player.reputation || 50;
                    const happiness = player.happiness || 50;
                    const activity = player.activity || 30;
                    
                    // –ò—Å–∫–ª—é—á–∞–µ–º —Å–∞–º–æ–≥–æ —Å–µ–±—è
                    if (playerName !== gameState.counselorName && player.telegram_id !== gameState.telegramId) {
                        allOpponents.set(player.telegram_id || playerName, {
                            name: playerName,
                            generation: playerGeneration,
                            level: campLevel,
                            reputation: reputation,
                            happiness: happiness,
                            activity: activity,
                            source: 'cloud',
                            power: (campLevel * 10) + reputation + happiness + activity
                        });
                    }
                });
            }
            
            if (allOpponents.size === 0) {
                // –ï—Å–ª–∏ –Ω–µ—Ç –¥—Ä—É–≥–∏—Ö –∏–≥—Ä–æ–∫–æ–≤
                const noPlayersOption = document.createElement('option');
                noPlayersOption.disabled = true;
                noPlayersOption.textContent = 'üö´ –ù–µ—Ç –¥—Ä—É–≥–∏—Ö –∏–≥—Ä–æ–∫–æ–≤ –¥–ª—è –±–∏—Ç–≤—ã';
                opponentSelect.appendChild(noPlayersOption);
                
                const infoOption = document.createElement('option');
                infoOption.disabled = true;
                infoOption.textContent = '–ü—Ä–∏–≥–ª–∞—Å–∏—Ç–µ –¥—Ä—É–∑–µ–π –≤ –∏–≥—Ä—É!';
                opponentSelect.appendChild(infoOption);
                return;
            }
            
            // –°–æ—Ä—Ç–∏—Ä—É–µ–º –ø–æ —Å–∏–ª–µ (—Å–Ω–∞—á–∞–ª–∞ –±–ª–∏–∑–∫–∏–µ –ø–æ —É—Ä–æ–≤–Ω—é)
            const playerPower = (gameState.campLevel * 10) + gameState.reputation + gameState.happiness + gameState.activity;
            const sortedOpponents = Array.from(allOpponents.values()).sort((a, b) => {
                const aDiff = Math.abs(a.power - playerPower);
                const bDiff = Math.abs(b.power - playerPower);
                return aDiff - bDiff;
            });
            
            // –î–æ–±–∞–≤–ª—è–µ–º –≤ —Å–µ–ª–µ–∫—Ç
            sortedOpponents.forEach(opponent => {
                const option = document.createElement('option');
                option.value = opponent.name;
                option.dataset.power = opponent.power;
                option.dataset.source = opponent.source;
                
                const powerDiff = opponent.power - playerPower;
                const diffText = powerDiff > 0 ? `+${powerDiff}` : `${powerDiff}`;
                const diffColor = powerDiff > 0 ? 'üî¥' : powerDiff < 0 ? 'üü¢' : 'üü°';
                
                option.textContent = `üë§ ${opponent.name} (${opponent.generation}) - –£—Ä.${opponent.level} ${diffColor}${diffText}`;
                opponentSelect.appendChild(option);
            });
            
            // –î–æ–±–∞–≤–ª—è–µ–º –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ –∫–æ–ª–∏—á–µ—Å—Ç–≤–µ —Å–æ–ø–µ—Ä–Ω–∏–∫–æ–≤
            const infoOption = document.createElement('option');
            infoOption.disabled = true;
            infoOption.textContent = `‚îÄ‚îÄ‚îÄ –î–æ—Å—Ç—É–ø–Ω–æ ${allOpponents.size} –∏–≥—Ä–æ–∫–æ–≤ ‚îÄ‚îÄ‚îÄ`;
            opponentSelect.insertBefore(infoOption, opponentSelect.children[1]);
        }

        // –ó–∞–≥—Ä—É–∑–∫–∞ —Ä–µ–π—Ç–∏–Ω–≥–∞
        async function loadLeaderboard() {
            const content = document.getElementById('leaderboard-content');
            
            content.innerHTML = '<div class="text-center text-gray-500">üîÑ –ó–∞–≥—Ä—É–∑–∫–∞ —Ä–µ–π—Ç–∏–Ω–≥–∞ –∏–∑ –æ–±–ª–∞–∫–∞...</div>';
            
            // –ü—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ –æ–±–Ω–æ–≤–ª—è–µ–º –¥–∞–Ω–Ω—ã–µ –∏–∑ JSONBin
            console.log('üîÑ –ü—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–∞—è –∑–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö –∏–∑ JSONBin –¥–ª—è —Ä–µ–π—Ç–∏–Ω–≥–∞...');
            await storage.loadFromJsonBin();
            
            const leaderboard = await storage.getLeaderboard();
            content.innerHTML = '';
            
            if (!isCloudReady) {
                content.innerHTML = `
                    <div class="text-center p-6">
                        <div class="text-red-500 mb-2">‚ö†Ô∏è –û–±–ª–∞—á–Ω–æ–µ —Ö—Ä–∞–Ω–∏–ª–∏—â–µ –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–æ</div>
                        <div class="text-sm text-gray-600">–†–µ–π—Ç–∏–Ω–≥ –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç —Ç–æ–ª—å–∫–æ –∏–≥—Ä–æ–∫–æ–≤ –∏–∑ JSONBin –æ–±–ª–∞–∫–∞</div>
                        <button onclick="storage.loadFromJsonBin().then(() => loadLeaderboard())" class="mt-3 px-4 py-2 bg-blue-500 text-white rounded-lg hover:bg-blue-600 transition-colors">
                            üîÑ –ü–æ–ø—Ä–æ–±–æ–≤–∞—Ç—å –ø–æ–¥–∫–ª—é—á–∏—Ç—å—Å—è
                        </button>
                    </div>
                `;
                return;
            }
            
            if (leaderboard.length === 0) {
                content.innerHTML = `
                    <div class="text-center p-6">
                        <div class="text-gray-500 mb-2">üìä –†–µ–π—Ç–∏–Ω–≥ –ø—É—Å—Ç</div>
                        <div class="text-sm text-gray-600">–°—Ç–∞–Ω—å—Ç–µ –ø–µ—Ä–≤—ã–º –∏–≥—Ä–æ–∫–æ–º –≤ –æ–±–ª–∞—á–Ω–æ–º —Ä–µ–π—Ç–∏–Ω–≥–µ!</div>
                        <div class="text-xs text-gray-500 mt-2">–°–æ—Ö—Ä–∞–Ω–∏—Ç–µ —Å–≤–æ–π –∞–∫–∫–∞—É–Ω—Ç –≤ –æ–±–ª–∞–∫–æ —á–µ—Ä–µ–∑ –ø–∞–Ω–µ–ª—å "–ê–∫–∫–∞—É–Ω—Ç"</div>
                        <button onclick="debugCloudData()" class="mt-3 px-4 py-2 bg-yellow-500 text-white rounded-lg hover:bg-yellow-600 transition-colors">
                            üîç –î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö
                        </button>
                    </div>
                `;
                return;
            }
            
            const headerElement = document.createElement('div');
            headerElement.className = 'mb-4 p-3 bg-green-50 rounded-lg border border-green-200';
            headerElement.innerHTML = `
                <div class="flex items-center justify-between">
                    <div class="text-sm font-semibold text-green-800">‚òÅÔ∏è –ì–ª–æ–±–∞–ª—å–Ω—ã–π —Ä–µ–π—Ç–∏–Ω–≥ Telegram</div>
                    <div class="text-xs text-green-600">${leaderboard.length} –∏–≥—Ä–æ–∫–æ–≤</div>
                </div>
                <div class="text-xs text-green-700 mt-1">–ü–æ–∫–∞–∑–∞–Ω—ã –∏–≥—Ä–æ–∫–∏ —Å Telegram –∞–∫–∫–∞—É–Ω—Ç–∞–º–∏</div>
            `;
            content.appendChild(headerElement);

            leaderboard.forEach((player, index) => {
                const playerAchievements = getPlayerAchievements(player);
                const achievementBadges = playerAchievements.map(a => 
                    `<span class="achievement-badge ${achievements[a].class}">${achievements[a].name}</span>`
                ).join('');
                
                const playerName = player.counselor_name || '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω—ã–π';
                const playerGeneration = player.generation || 'Gen Z';
                const campLevel = player.camp_level || 1;
                const reputation = player.reputation || 0;
                const squadSize = player.squad_size || 10;
                const battleWins = player.battle_wins || 0;
                const concertsHeld = player.concerts_held || 0;
                const totalRating = player.total_rating || 0;
                
                const generationClass = playerGeneration.toLowerCase().replace(' ', '-');
                
                const isCurrentPlayer = gameState.telegramId && player.telegram_id === gameState.telegramId;
                const playerClass = isCurrentPlayer ? 'p-3 bg-green-100 border-2 border-green-300 rounded-lg text-sm mb-2' : 'p-3 bg-gray-50 rounded-lg text-sm mb-2';
                
                const playerElement = document.createElement('div');
                playerElement.className = playerClass;
                playerElement.innerHTML = `
                    <div class="flex justify-between items-start mb-2">
                        <div class="font-semibold">
                            ${index + 1}. ${playerName}
                            ${isCurrentPlayer ? '<span class="text-xs text-green-600 ml-2">üë§ –í—ã</span>' : ''}
                        </div>
                        <div class="flex items-center gap-2">
                            <span class="generation-badge ${generationClass}">${playerGeneration}</span>
                            <span class="text-xs font-bold" style="color: #2E8B57;">–†–µ–π—Ç–∏–Ω–≥: ${Math.floor(totalRating)}</span>
                        </div>
                    </div>
                    <div class="text-xs mb-2" style="color: #2F4F4F;">
                        üèïÔ∏è${campLevel} üéØ${Math.floor(reputation)} üë•${squadSize} 
                        ‚öîÔ∏è${battleWins} üé≠${concertsHeld}
                    </div>
                    <div class="text-xs">${achievementBadges}</div>
                `;
                
                content.appendChild(playerElement);
            });
        }

        // –ü–æ–ª—É—á–µ–Ω–∏–µ –¥–æ—Å—Ç–∏–∂–µ–Ω–∏–π –∏–≥—Ä–æ–∫–∞
        function getPlayerAchievements(player) {
            const playerAchievements = [];
            
            Object.keys(achievements).forEach(key => {
                const achievement = achievements[key];
                const tempState = { ...gameState, ...player };
                const originalState = gameState;
                gameState = tempState;
                
                if (achievement.check()) {
                    playerAchievements.push(key);
                }
                
                gameState = originalState;
            });
            
            return playerAchievements;
        }

        // –ü—Ä–æ–≤–µ—Ä–∫–∞ –¥–æ—Å—Ç–∏–∂–µ–Ω–∏–π
        function checkAchievements() {
            Object.keys(achievements).forEach(key => {
                const achievement = achievements[key];
                
                if (!gameState.achievements.includes(key) && achievement.check()) {
                    gameState.achievements.push(key);
                    showNotification(`üèÜ –î–æ—Å—Ç–∏–∂–µ–Ω–∏–µ –ø–æ–ª—É—á–µ–Ω–æ: ${achievement.name}!`, 'achievement');
                }
            });
        }

        // –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –∏–≥—Ä—ã
        async function saveGame() {
            if (!gameState.counselorName || !gameState.telegramId) return;
            
            gameState.lastPlayed = Date.now();
            
            // –°–æ—Ö—Ä–∞–Ω—è–µ–º –ª–æ–∫–∞–ª—å–Ω–æ
            storage.saveGameLocal(gameState);
        }

        // –ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö –∏–≥—Ä–æ–∫–∞
        async function loadPlayerData(savedData) {
            gameState.counselorName = savedData.counselorName || '';
            gameState.telegramId = savedData.telegramId || '';
            gameState.generation = savedData.generation || '';
            gameState.campLevel = savedData.campLevel || 1;
            gameState.budget = savedData.budget !== undefined ? savedData.budget : 1000;
            gameState.energy = savedData.energy !== undefined ? savedData.energy : 100;
            gameState.maxEnergy = savedData.maxEnergy !== undefined ? savedData.maxEnergy : 100;
            gameState.creativity = savedData.creativity !== undefined ? savedData.creativity : 0;
            gameState.reputation = savedData.reputation !== undefined ? savedData.reputation : 50;
            gameState.squadSize = savedData.squadSize || 10;
            gameState.happiness = savedData.happiness !== undefined ? savedData.happiness : 50;
            gameState.activity = savedData.activity !== undefined ? savedData.activity : 30;
            gameState.buildings = (savedData.buildings || []).map(building => ({
                ...building,
                level: building.level || 1
            }));
            gameState.achievements = savedData.achievements || [];
            gameState.battleWins = savedData.battleWins || 0;
            gameState.concertsHeld = savedData.concertsHeld || 0;
            gameState.creativityRating = savedData.creativityRating || 0;
            gameState.accumulatedBudget = savedData.accumulatedBudget || 0;
            gameState.accumulatedCreativity = savedData.accumulatedCreativity || 0;
            gameState.lastIncomeTime = savedData.lastIncomeTime || Date.now();
            gameState.lastPlayed = savedData.lastPlayed || Date.now();
            gameState.lastBattleTime = savedData.lastBattleTime || 0;
            
            // –ù–æ–≤—ã–µ –ø–æ–ª—è –¥–ª—è –±–∞–ª–∞–Ω—Å–∏—Ä–æ–≤–∫–∏
            gameState.lastEventTime = savedData.lastEventTime || 0;
            gameState.lastTrainingTime = savedData.lastTrainingTime || 0;
            gameState.lastConcertTime = savedData.lastConcertTime || 0;
            gameState.lastRestTime = savedData.lastRestTime || 0;
            gameState.dailyEvents = savedData.dailyEvents || 0;
            gameState.dailyTrainings = savedData.dailyTrainings || 0;
            gameState.dailyConcerts = savedData.dailyConcerts || 0;
            gameState.dailyRests = savedData.dailyRests || 0;
            gameState.lastDailyReset = savedData.lastDailyReset || Date.now();
            gameState.totalPlayTime = savedData.totalPlayTime || 0;
            gameState.sessionStartTime = Date.now();
            
            updateUI();
        }

        // –ü–æ–ª–Ω–æ–µ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –∞–∫–∫–∞—É–Ω—Ç–∞ –≤ –æ–±–ª–∞–∫–æ
        async function saveAccountComplete() {
            if (!gameState.counselorName || !gameState.telegramId) {
                showNotification('–ù–µ—Ç –∞–∫—Ç–∏–≤–Ω–æ–≥–æ –∞–∫–∫–∞—É–Ω—Ç–∞!', 'error');
                return;
            }
            
            const button = event.target;
            const originalText = button.textContent;
            button.disabled = true;
            button.textContent = 'üíæ –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ...';
            
            try {
                let cloudSaved = false;
                let localSaved = false;

                if (isCloudReady) {
                    const playerData = {
                        counselor_name: gameState.counselorName,
                        telegram_id: gameState.telegramId,
                        generation: gameState.generation,
                        camp_level: gameState.campLevel,
                        budget: gameState.budget,
                        energy: gameState.energy,
                        max_energy: gameState.maxEnergy,
                        creativity: gameState.creativity,
                        reputation: gameState.reputation,
                        squad_size: gameState.squadSize,
                        happiness: gameState.happiness,
                        activity: gameState.activity,
                        buildings: gameState.buildings,
                        achievements: gameState.achievements,
                        concerts_held: gameState.concertsHeld,
                        creativity_rating: gameState.creativityRating,
                        battle_wins: gameState.battleWins,
                        accumulated_budget: gameState.accumulatedBudget,
                        accumulated_creativity: gameState.accumulatedCreativity
                    };

                    cloudSaved = await storage.savePlayerRating(playerData);
                }

                await saveGame();
                localSaved = true;

                if (cloudSaved && localSaved) {
                    showNotification('–ê–∫–∫–∞—É–Ω—Ç —Å–æ—Ö—Ä–∞–Ω–µ–Ω –≤ –æ–±–ª–∞–∫–µ –∏ –ª–æ–∫–∞–ª—å–Ω–æ!', 'success');
                } else if (localSaved) {
                    showNotification('–ê–∫–∫–∞—É–Ω—Ç —Å–æ—Ö—Ä–∞–Ω–µ–Ω –ª–æ–∫–∞–ª—å–Ω–æ!', 'success');
                } else {
                    showNotification('–û—à–∏–±–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è!', 'error');
                }

                loadLeaderboard();
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è:', error);
                showNotification('–û—à–∏–±–∫–∞ –ø—Ä–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–∏ –∞–∫–∫–∞—É–Ω—Ç–∞', 'error');
            } finally {
                button.disabled = false;
                button.textContent = originalText;
            }
        }



        // –í—ã—Ö–æ–¥ –∏–∑ –∞–∫–∫–∞—É–Ω—Ç–∞
        function logoutAccount() {
            gameState = {
                counselorName: '',
                telegramId: '',
                generation: '',
                campLevel: 1,
                budget: 1000,
                energy: 100,
                maxEnergy: 100,
                creativity: 0,
                reputation: 50,
                squadSize: 10,
                happiness: 50,
                activity: 30,
                buildings: [],
                achievements: [],
                concertsHeld: 0,
                creativityRating: 0,
                battleWins: 0,
                lastPlayed: Date.now(),
                accumulatedBudget: 0,
                accumulatedCreativity: 0,
                lastIncomeTime: Date.now(),
                lastBattleTime: 0
            };
            
            document.getElementById('generation').value = '';
            
            document.getElementById('registration-panel').style.display = 'block';
            document.getElementById('building-panel').style.display = 'none';
            document.getElementById('activities-panel').style.display = 'none';
            document.getElementById('competitions-panel').style.display = 'none';
            document.getElementById('leaderboard-panel').style.display = 'none';
            document.getElementById('account-panel').style.display = 'none';
            document.getElementById('player-stats').style.display = 'none';
            document.getElementById('additional-stats').style.display = 'none';
            document.getElementById('game-tabs').style.display = 'none';
            
            updateUI();
            
            showNotification('–í—ã –≤—ã—à–ª–∏ –∏–∑ –∞–∫–∫–∞—É–Ω—Ç–∞', 'info');
        }

        // –ü–æ–∫–∞–∑ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π
        function showNotification(message, type = 'info') {
            const notification = document.getElementById('notification');
            notification.textContent = message;
            
            const colors = {
                success: 'linear-gradient(135deg, #32CD32 0%, #228B22 100%)',
                error: 'linear-gradient(135deg, #FF6347 0%, #DC143C 100%)',
                info: 'linear-gradient(135deg, #2E8B57 0%, #228B22 100%)',
                achievement: 'linear-gradient(135deg, #FFD700 0%, #FFA500 100%)',
                warning: 'linear-gradient(135deg, #FFA500 0%, #FF8C00 100%)'
            };
            
            notification.style.background = colors[type] || colors.info;
            notification.classList.add('show');
            
            setTimeout(() => {
                notification.classList.remove('show');
            }, 3000);
        }

        // –ê–≤—Ç–æ—Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –∫–∞–∂–¥—ã–µ 30 —Å–µ–∫—É–Ω–¥
        function startAutoSave() {
            setInterval(async () => {
                if (gameState.counselorName && gameState.telegramId) {
                    console.log('üîÑ –ê–≤—Ç–æ—Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –∫–∞–∂–¥—ã–µ 30 —Å–µ–∫...', new Date().toLocaleTimeString());
                    
                    // –í—Å–µ–≥–¥–∞ —Å–æ—Ö—Ä–∞–Ω—è–µ–º –ª–æ–∫–∞–ª—å–Ω–æ –∫–∞–∂–¥—ã–µ 30 —Å–µ–∫—É–Ω–¥
                    storage.saveGameLocal(gameState);
                    
                    const now = Date.now();
                    const lastCloudSave = storage.loadLocal('lastCloudSave') || 0;
                    
                    // –ê–≤—Ç–æ—Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –≤ –æ–±–ª–∞–∫–æ –∫–∞–∂–¥—ã–µ 60 —Å–µ–∫—É–Ω–¥ (2 —Ü–∏–∫–ª–∞)
                    if (isCloudReady && (now - lastCloudSave) > 60000) {
                        console.log('‚òÅÔ∏è –ê–≤—Ç–æ—Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –≤ JSONBin –∫–∞–∂–¥—É—é –º–∏–Ω—É—Ç—É...');
                        
                        const playerData = {
                            counselor_name: gameState.counselorName,
                            telegram_id: gameState.telegramId,
                            generation: gameState.generation,
                            camp_level: gameState.campLevel,
                            budget: gameState.budget,
                            energy: gameState.energy,
                            max_energy: gameState.maxEnergy,
                            creativity: gameState.creativity,
                            reputation: gameState.reputation,
                            squad_size: gameState.squadSize,
                            happiness: gameState.happiness,
                            activity: gameState.activity,
                            buildings: gameState.buildings,
                            achievements: gameState.achievements,
                            concerts_held: gameState.concertsHeld,
                            creativity_rating: gameState.creativityRating,
                            battle_wins: gameState.battleWins,
                            accumulated_budget: gameState.accumulatedBudget,
                            accumulated_creativity: gameState.accumulatedCreativity
                        };

                        const cloudSaved = await storage.savePlayerRating(playerData);
                        if (cloudSaved) {
                            storage.saveLocal('lastCloudSave', now);
                            console.log('‚úÖ –ê–≤—Ç–æ—Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –≤ JSONBin –∑–∞–≤–µ—Ä—à–µ–Ω–æ');
                            
                            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –æ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–∏ –∫–∞–∂–¥—ã–µ 2 –º–∏–Ω—É—Ç—ã
                            const lastNotification = storage.loadLocal('lastSaveNotification') || 0;
                            if (now - lastNotification > 120000) {
                                showNotification('üíæ –ü—Ä–æ–≥—Ä–µ—Å—Å –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω –≤ –æ–±–ª–∞–∫–æ', 'success');
                                storage.saveLocal('lastSaveNotification', now);
                            }
                        } else {
                            console.log('‚ùå –ê–≤—Ç–æ—Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –≤ JSONBin –Ω–µ —É–¥–∞–ª–æ—Å—å');
                        }
                    }
                }
            }, 30000); // –ê–≤—Ç–æ—Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –∫–∞–∂–¥—ã–µ 30 —Å–µ–∫—É–Ω–¥
        }

        // –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –ø—Ä–∏ –∑–∞–∫—Ä—ã—Ç–∏–∏ –≤–∫–ª–∞–¥–∫–∏
        window.addEventListener('beforeunload', async (event) => {
            if (gameState.counselorName && gameState.telegramId) {
                await saveGame();
            }
        });

        // –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –ø—Ä–∏ –ø–æ—Ç–µ—Ä–µ —Ñ–æ–∫—É—Å–∞
        document.addEventListener('visibilitychange', async () => {
            if (document.hidden && gameState.counselorName && gameState.telegramId) {
                await saveGame();
            }
        });

        // Elements SDK –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è
        async function onConfigChange(config) {
            const titleElement = document.getElementById('game-title');
            const subtitleElement = document.getElementById('game-subtitle');
            
            if (titleElement) {
                titleElement.textContent = `üèïÔ∏è ${config.camp_name || defaultConfig.camp_name}`;
            }
            
            if (subtitleElement) {
                subtitleElement.textContent = config.camp_motto || defaultConfig.camp_motto;
            }
        }

        function mapToCapabilities(config) {
            return {
                recolorables: [],
                borderables: [],
                fontEditable: undefined,
                fontSizeable: undefined
            };
        }

        function mapToEditPanelValues(config) {
            return new Map([
                ['camp_name', config.camp_name || defaultConfig.camp_name],
                ['camp_motto', config.camp_motto || defaultConfig.camp_motto]
            ]);
        }

        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è Elements SDK
        if (window.elementSdk) {
            window.elementSdk.init({
                defaultConfig,
                onConfigChange,
                mapToCapabilities,
                mapToEditPanelValues
            });
        }

        // –î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞ –æ–±–ª–∞—á–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö
        async function debugCloudData() {
            console.log('üîç === –î–ò–ê–ì–ù–û–°–¢–ò–ö–ê –û–ë–õ–ê–ß–ù–´–• –î–ê–ù–ù–´–• ===');
            console.log('isCloudReady:', isCloudReady);
            console.log('cloudPlayers.length:', cloudPlayers.length);
            console.log('cloudPlayers:', cloudPlayers);
            
            try {
                console.log('üì• –ü–æ–ø—ã—Ç–∫–∞ –ø—Ä—è–º–æ–π –∑–∞–≥—Ä—É–∑–∫–∏ –∏–∑ JSONBin...');
                const response = await fetch(`https://api.jsonbin.io/v3/b/${API_CONFIG.BIN_ID}/latest`, {
                    method: 'GET',
                    headers: {
                        'X-Master-Key': API_CONFIG.API_KEY,
                        'Content-Type': 'application/json'
                    }
                });
                
                if (response.ok) {
                    const data = await response.json();
                    console.log('üìä –ü—Ä—è–º–æ–π –æ—Ç–≤–µ—Ç –æ—Ç JSONBin:', data);
                    console.log('üìä –ò–≥—Ä–æ–∫–∏ –≤ –æ—Ç–≤–µ—Ç–µ:', data.record?.players?.length || 0);
                    
                    if (data.record?.players) {
                        data.record.players.forEach((player, index) => {
                            console.log(`üë§ –ò–≥—Ä–æ–∫ ${index + 1}:`, {
                                name: player.counselor_name,
                                telegram_id: player.telegram_id,
                                last_updated: player.last_updated,
                                version: player.version
                            });
                        });
                    }
                } else {
                    console.error('‚ùå –û—à–∏–±–∫–∞ HTTP:', response.status, response.statusText);
                }
            } catch (error) {
                console.error('‚ùå –û—à–∏–±–∫–∞ –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∏:', error);
            }
            
            showNotification('–î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–∞. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –∫–æ–Ω—Å–æ–ª—å –±—Ä–∞—É–∑–µ—Ä–∞ (F12)', 'info');
        }

        // –¢—Ä–µ–∫–∏–Ω–≥ –≤—Ä–µ–º–µ–Ω–∏ –∏–≥—Ä—ã
        function updatePlayTime() {
            if (gameState.counselorName && gameState.sessionStartTime) {
                const sessionTime = Date.now() - gameState.sessionStartTime;
                gameState.totalPlayTime += sessionTime;
                gameState.sessionStartTime = Date.now();
            }
        }

        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –≤—Ä–µ–º–µ–Ω–∏ –∏–≥—Ä—ã –∫–∞–∂–¥—ã–µ 30 —Å–µ–∫—É–Ω–¥
        function startPlayTimeTracking() {
            setInterval(() => {
                updatePlayTime();
            }, 30000);
        }

        // –ó–∞–ø—É—Å–∫ –∏–≥—Ä—ã
        document.addEventListener('DOMContentLoaded', () => {
            initGame();
            startAutoSave();
            startPlayTimeTracking();
        });

        // –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –≤—Ä–µ–º–µ–Ω–∏ –∏–≥—Ä—ã –ø—Ä–∏ –∑–∞–∫—Ä—ã—Ç–∏–∏
        window.addEventListener('beforeunload', () => {
            updatePlayTime();
        });
    </script>
 <script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'99751ec1645218d6',t:'MTc2MTkzNDM0MS4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script></body>
</html>
